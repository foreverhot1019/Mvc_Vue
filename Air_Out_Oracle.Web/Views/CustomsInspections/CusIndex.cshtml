@model AirOut.Web.Models.CustomsInspection
@{
    ViewBag.Title = "报关信息";
    var Num = 1;
    var picture = ViewBag.picture;
    var OPS_ENid = ViewBag.OPS_ENid;
    var MBLId = ViewBag.MBLId;
}
<!--DataGrid 回车Editor下一个 和 为控件添加 Key事件 -->
<script src="~/Scripts/jsext.js?date=2019013001"></script>
<!--真实 下载进度条 -->
<script async defer src="~/Scripts/DownLoadProgress.js"></script>
<script type="text/javascript">
    //表单唯一值，防止重复提交
    var ActionGuidName = '@(ViewData["ActionGuidName"]??"")';
    var ActionGuid = '@(ViewData["ActionGuidName"] == null ? "" : (ViewData[ViewData["ActionGuidName"].ToString()] ?? ""))';
</script>

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>@ViewBag.Title</h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Index", "Home")">主页</a>
            </li>
            <li>
                <a href="#">空运承揽</a>
            </li>
            <li class="active">
                <strong>@ViewBag.Title</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                @*<div class="ibox-title">
                    <h5></h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <i class="fa fa-wrench"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user">
                            <li>
                                <a href="table_data_tables.html#">Config option 1</a>
                            </li>
                            <li>
                                <a href="table_data_tables.html#">Config option 2</a>
                            </li>
                        </ul>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                        
                    </div>
                </div>*@
                <div class="ibox-content">

                    <div id="CusIndex_panel" class="easyui-panel" title="报关信息" style="width:100%;height:auto;padding:10px;"
                         data-options="collapsible:true">
                        <div class="col-lg-12">
                            @*<button type="button" onclick="ToOP_EN()">返回</button>*@
                            <button type="button" id="Saveeidt" onclick="SaveEdit()">保存</button>  @**@
                            <button type="button" onclick="ToDocMent1()">单证管理</button>
                            <button type="button" onclick="javascript: window.location.href = '/OPS_M_Orders/WarehouseSee?MBL=' + $('#MBL').textbox('getValue');">仓库信息</button>
                            <button type="button" onclick="ToOP_EN()">接单信息</button>
                            <button type="button" onclick="javascript: window.location.href = '/Bms_Bill_Aps/BmsBillApView?OPS_M_OrdId=' + $('#MBLId').val()">结算信息</button>
                        </div>
                        <form id="CusIndex_form" style="margin-left: auto;margin-right: auto;" data-options="collapsible:true">
                            @Html.HiddenFor(model => model.Id)
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">业务编号:</label>
                                <input id="Operation_ID" name="Operation_ID" tabindex="@(Num++)" data-options="prompt1:'业务编号'" style="width:70%" class="easyui-textbox" type="text" value="@Model.Operation_ID" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">航班:</label>
                                <input id="Flight_NO" name="Flight_NO" tabindex="@(Num++)" data-options="prompt1:'航班'" style="width:70%" class="easyui-textbox" type="text" value="@Model.Flight_NO" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">总单号:</label>
                                <input id="MBL" name="MBL" tabindex="@(Num++)" data-options="prompt1:'总单号'" style="width:70%" class="easyui-textbox" type="text" value="@Model.MBL" />
                                <input id="MBLId" name="MBLId" tabindex="@(Num++)" hidden type="text" value="@MBLId" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">航班时间:</label>
                                <input id="Flight_Date_Want" name="Flight_Date_Want" tabindex="@(Num++)" data-options="prompt1:'航班时间'" style="width:70%" class="easyui-datebox" type="text" value='@(Model == null ? "" : (Model.Flight_Date_Want == null ? "" : ((DateTime)Model.Flight_Date_Want).ToString("yyyy-MM-dd")))' />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">委托方:</label>
                                <input id="Consign_Code_CK" name="Consign_Code_CK" tabindex="@(Num++)" data-options="prompt1:'委托方'" style="width:70%" class="easyui-combogrid" type="text" value="@Model.Consign_Code_CK" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">订舱方:</label>
                                <input id="Book_Flat_Code" name="Book_Flat_Code" tabindex="@(Num++)" data-options="prompt1:'订舱方'" style="width:70%" class="easyui-combogrid" type="text" value="@Model.Book_Flat_Code" />
                            </div>
                            <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                <h1>报关信息</h1>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">报关方式:</label>
                                <input id="Customs_Declaration" name="Customs_Declaration" tabindex="@(Num++)" data-options="prompt1:'报关方式'" style="width:70%" class="easyui-combogrid" type="text" value="@Model.Customs_Declaration" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">票数:</label>
                                <input id="Num_BG" name="Num_BG" tabindex="@(Num++)" data-options="prompt1:'票数'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Num_BG" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">备注:</label>
                                <input id="Remarks_BG" name="Remarks_BG" tabindex="@(Num++)" data-options="prompt1:'备注'" style="width:70%" class="easyui-textbox" type="text" value="@Model.Remarks_BG" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">报关方:</label>
                                <input id="Customs_Broker_BG" name="Customs_Broker_BG" tabindex="@(Num++)" data-options="prompt1:'报关方'" style="width:70%" class="easyui-combogrid" type="text" value="@Model.Customs_Broker_BG" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">报关日期:</label>
                                <input id="Customs_Date_BG" name="Customs_Date_BG" tabindex="@(Num++)" data-options="prompt1:'报关日期'" style="width:70%" class="easyui-datebox" type="text" value='@(Model == null ? "" : (Model.Customs_Date_BG == null ? "" : ((DateTime)Model.Customs_Date_BG).ToString("yyyy-MM-dd")))' />
                            </div>
                            <div class="form-group col-md-4">
                                <br><br>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">托书件数:</label>
                                <input id="Pieces_TS" name="Pieces_TS" tabindex="@(Num++)" data-options="prompt1:'进仓件数'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Pieces_TS" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">托书毛重:</label>
                                <input id="Weight_TS" name="Weight_TS" tabindex="@(Num++)" data-options="prompt1:'进仓毛重'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Weight_TS" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">托书体积:</label>
                                <input id="Volume_TS" name="Volume_TS" tabindex="@(Num++)" data-options="prompt1:'进仓体积'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Volume_TS" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">进仓件数:</label>
                                <input id="Pieces_Fact" name="Pieces_Fact" tabindex="@(Num++)" data-options="prompt1:'托书件数'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Pieces_Fact" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">进仓毛重:</label>
                                <input id="Weight_Fact" name="Weight_Fact" tabindex="@(Num++)" data-options="prompt1:'托书毛重'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Weight_Fact" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">进仓体积:</label>
                                <input id="Volume_Fact" name="Volume_Fact" tabindex="@(Num++)" data-options="prompt1:'托书体积'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Volume_Fact" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">报关件数:</label>
                                <input id="Pieces_BG" name="Pieces_BG" tabindex="@(Num++)" data-options="prompt1:'报关件数'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Pieces_BG" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">报关毛重:</label>
                                <input id="Weight_BG" name="Weight_BG" tabindex="@(Num++)" data-options="prompt1:'报关毛重'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Weight_BG" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">报关体积:</label>
                                <input id="Volume_BG" name="Volume_BG" tabindex="@(Num++)" data-options="prompt1:'报关体积'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Volume_BG" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">海关查检:</label>
                                <input id="IS_Checked_BG" name="IS_Checked_BG" tabindex="@(Num++)" data-options="prompt1:'海关查检'" style="width:70%" class="easyui-checkbox" type="checkbox" value="@Model.IS_Checked_BG" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">海关查检日期:</label>
                                <input id="Check_QTY" name="Check_QTY" tabindex="@(Num++)" data-options="prompt1:'海关查检日期'" style="width:70%" class="easyui-datebox" type="text" value='@(Model == null ? "" : (Model.Check_QTY == null ? "" : ((DateTime)Model.Check_QTY).ToString("yyyy-MM-dd")))' />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">海关查检次数:</label>
                                <input id="Check_Date" name="Check_Date" tabindex="@(Num++)" data-options="prompt1:'报关体积'" style="width:70%" class="easyui-numberbox" type="text" value="@Model.Check_Date" />
                            </div>
                            @*<div class="form-group col-md-12">
                    <label for="name" style="width:10%">附档文件上传:</label>
                    <input id="Fileupload" name="Fileupload" tabindex="@(Num++)" data-options="prompt1:'附档文件上传'" style="width:20%" class="easyui-textbox" type="file" />
                </div>*@
                        </form>

                        <div class="form-group col-lg-12">
                            <div class="form-group col-md-4">
                                <button class="btn btn-primary" type="button" id="Append" onclick="AppendCusInfo()">新增</button>
                                <button class="btn btn-danger" type="button" id="Delete" onclick="removeIt()">删除</button>
                            </div>
                            <div class="form-group col-md-1">
                                <label for="CusUpload_GUID">附档上传：</label>
                            </div>
                            <div class="form-group col-md-2">
                                <input class="easyui-validatebox" type="hidden" id="CusUpload_GUID" name="CusUpload_GUID" />
                                <input id="file_upload1" name="file_upload" type="file" multiple="multiple">
                                <div id="fileQueue1" class="fileQueue"></div>
                                <div id="div_files1"></div>
                            </div>
                            <div id="div_fileupload" class="form-groupcol-md-5">
                                @*<a class="example1" id="DeliveryUploadPic" href=""></a>*@
                                @{
                                    var rowi = 0;
                                    if (picture != null)
                                    {
                                        foreach (var item in picture)
                                        {
                                            rowi = rowi + 1;
                                            if (item.OperatingPoint == 4)
                                            {
                                                <a href="@item.Address" class="delPic" id="Fileupload_@item.Id" target="view_frame" onmouseout="return displeyImg('Img_@item.Id');" onmousemove="return imgblur('Img_@item.Id');">@item.Remark </a>
                                                <a href="javascript:void(0)" class="easyui-linkbutton" id="Img_@item.Id" data-options="iconCls:'icon-remove',plain:true" style="visibility:hidden" onclick="deletepicture('@item.Id')" onmouseout="return displeyImg('Img_@item.Id');" onmousemove="return imgblur('Img_@item.Id');"></a>
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                        <div class="table-responsive">
                            <table id="customsinspection_datagrid" class="easyui-datagrid" title="" style="width:auto;height:auto"
                                   data-options="
							rownumbers:true,
							checkOnSelect:true,
							selectOnCheck:true,
							idField:'Id',
							sortName:'Id',
							sortOrder:'desc',
							remoteFilter: true,
							singleSelect: true,
							toolbar: '#customsinspection_toolbar',
							url: '',
							method: 'get',
							onClickCell: onClickCell,
							onSelect:onSelect,
							pagination: 'true',
                            onBeginEdit:onBeginEdit,
                            onLoadSuccess:onLoadSuccess,
                            onClickRow:onClickRow">
                                <thead>
                                    <tr>
                                        <th data-options="field:'ck',checkbox:true"></th>
                                        <th data-options="field:'Customs_Declaration',width:140,sortable:true,resizable:true,
                                    formatter:CusTypeformatter,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.Customs_Declaration)</th>
                                <th data-options="field:'Num_BG',width:100,align:'right',sortable:true,resizable:true,
									editor:{
										type:'numberbox',
										options:{
											required:true ,precision:2
										}
								}">@Html.DisplayNameFor(model => model.Num_BG)</th>
                                <th data-options="field:'Remarks_BG',width:250,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,500]'
										}
								}">@Html.DisplayNameFor(model => model.Remarks_BG)</th>
                                <th data-options="field:'Customs_Date_BG',width:160,align:'right',sortable:true,resizable:true,
									formatter:dateformatter,
									editor:{
										type:'datebox',
										options:{
											required:true
										}
								}">@Html.DisplayNameFor(model => model.Customs_Date_BG)</th>
                            </tr>
                        </thead>
                        </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<div id="importwindow" class="easyui-window" title="Excel 导入" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,closed:true,iconCls:'icon-paperclip'" style="width:500px;height:260px;padding:10px;">
    <p><input type="file" name="file_upload" id="file_upload" /></p>
</div>

@section Scripts {
    <script type="text/javascript">
    var xxx = 10;
    var urlpic = "";
    $(function () {

        toopTip(".delPic", "删除");
        urlpic = '/Pictures/Upload?ID=' + $("#Id").val();

        $("#file_upload1").uploadifive({//uploadifive
            'height': 30,
            'fileTypeDesc': 'Image Files',
            'fileTypeExts': '*.gif; *.jpg; *.png; *.bmp;*.tif;*.doc;*.xls;*.zip',
            'uploadScript': urlpic + "&Talbe=CustomsInspections&type=CusInspUpload",
            'buttonText': '上传',
            'multi': true,
            'displayData': 'speed',
            'formData': { 'modelType': 'Picture' },
            'width': 120,
            'successTimeout': 100000,
            'onFallback': function () {
                $.messager.alert('上传错误', '上传错误，请重试！<br>', 'error');
                $('#file_upload').uploadifive('clearQueue')
            },
            'onSelect': function (queue) {
                $.messager.progress({
                    title: '执行上传',
                    msg: '请等待...'
                });
            },
            'onUpload': function (file) {
                console.log("file:", file);
            },
            'onUploadComplete': function (file, data) {
                $.messager.progress('close');
                var data = $.parseJSON(data);
                if (data.Success === false) {
                    $.messager.alert('上传错误', '上传错误，请修改后再上传！<br>' + data.ErrMsg, 'error');
                    $("#file_upload").uploadifive('clearQueue')
                } else {
                    window.location.reload();//刷新当前页面
                }
                return true;
            }
        });


        initbindingcombogrid()
        initEasyUIControl();//回车下一个控件

        var Operation_ID = $("#Operation_ID").textbox("getValue");
        $('#customsinspection_datagrid').datagrid({ url: '/CustomsInspections/GetData?operation_id=' + Operation_ID })

        if(Operation_ID==0){
            $("#Delete").attr("disabled","disabled");
            $("#Append").attr("disabled","disabled");
            //$("#Saveeidt").attr("disabled","disabled");
        }
        $("#Operation_ID").textbox("disable");
        $("#Flight_NO").textbox("disable");
        $("#Flight_Date_Want").datebox("disable");
        $("#MBL").textbox("disable");
        $("#Consign_Code_CK").textbox("disable");
        $("#Book_Flat_Code").combogrid("disable");
        $("#Pieces_TS").textbox("disable");
        $("#Weight_TS").textbox("disable");
        $("#Volume_TS").textbox("disable");
        $("#Pieces_Fact").textbox("disable");
        $("#Weight_Fact").textbox("disable");
        $("#Volume_Fact").textbox("disable");
        //$("#Check_Date").textbox("disable");

        var FormNAMEData = @Html.Raw(ViewData["FormNAME"] ?? "{}");//用于获取所有下拉列表框的值

        var FromData = {
            "Customs_Broker_BG":"@Model.Customs_Broker_BG",
            lenght: 2
        }
        FromData = $.extend(FromData,FormNAMEData);

        if(FromData.Consign_Code_CKNAME != null && FromData.Consign_Code_CKNAME != "" ){
            $("#Consign_Code_CK").combogrid("setText", FromData.Consign_Code_CKNAME);
        }
        if(FromData.Book_Flat_CodeNAME != null && FromData.Book_Flat_CodeNAME != "" ){
            $("#Book_Flat_Code").combogrid("setText", FromData.Book_Flat_CodeNAME);
        }

        //设置ComboGrid真实url(为了不页面进入后 不立即加载数据，优化页面载入速度)
        resetCombogridUrl("#CusIndex_form", "url1", false, FromData);
        //$("#Customs_Broker_BG").combogrid("setText", FromData.Customs_Broker_BGName);

    });


    /************************/
    /*     上传文件删除     */
    /*      20071106        */
    /************************/


    /*easyui，鼠标划过悬浮，显示一个小提示框的方法*/
    function toopTip(idOrClass, showText) {
        $("input[id^='Fileupload_']").tooltip({
            position: 'top',
            content: '<span style="color:#6A6A6A">' + showText + '</span>',
            onShow: function () {
                $(this).tooltip('tip').css({
                    backgroundColor: '#ffffff',
                    borderColor: '#ff8c40'
                });
            }
        });
    }
    //日期格式转换   /Date(1542729600000)/ 转换为 yyyy-mm-dd
    function ChangeDateFormat(cellval)
    {
        var date = new Date(parseInt(cellval.replace("/Date(", "").replace(")/", ""), 10));
        var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
        var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
        return date.getFullYear() + "-" + month + "-" + currentDate;
    }
    //加载最后一条数据，到datagrid上面的控件中
    function loadingdata(){
        var rows = $dg.datagrid('getRows');
        if (rows.length > 0) {
            $("#Id").val(rows[rows.length - 1].Id);
            $("#Customs_Declaration").combogrid("setValue",  rows[rows.length - 1].Customs_Declaration);
            $("#Num_BG").textbox("setValue", rows[rows.length - 1].Num_BG);
            $("#Remarks_BG").textbox("setValue", rows[rows.length - 1].Remarks_BG);
            $("#Customs_Broker_BG").textbox("setValue", rows[rows.length - 1].Customs_Broker_BG);

            if(rows[rows.length - 1].Customs_Date_BG != null && rows[rows.length - 1].Customs_Date_BG != ""){
                var $customs_date_gb = ChangeDateFormat(rows[rows.length - 1].Customs_Date_BG);
                $("#Customs_Date_BG").datebox("setValue", $customs_date_gb);
            }

            $("#Pieces_BG").numberbox("setValue", rows[rows.length - 1].Pieces_BG);
            $("#Weight_BG").numberbox("setValue", rows[rows.length - 1].Weight_BG);
            $("#Volume_BG").numberbox("setValue", rows[rows.length - 1].Volume_BG);
            if(rows[rows.length - 1].IS_Checked_BG){
                $("#IS_Checked_BG").prop("checked",true);
            }else{
                $("#IS_Checked_BG").prop("checked",false);
            }

            if(rows[rows.length - 1].Check_QTY != null && rows[rows.length - 1].Check_QTY != ""){
                var $Check_QTY = ChangeDateFormat(rows[rows.length - 1].Check_QTY);
                $("#Check_QTY").datebox("setValue", $Check_QTY);
            }
            //$("#Check_QTY").datebox("setValue", rows[rows.length - 1].Check_QTY);
            //$("#Check_Date").numberbox("setValue", rows[rows.length - 1].Check_Date);
        }else{

            $("#Id").val("0");
            $("#Customs_Declaration").combogrid("setValue",  "");
            $("#Num_BG").textbox("setValue", "");
            $("#Remarks_BG").textbox("setValue", "");
            //$("#Customs_Broker_BG").textbox("setValue", "QPBGH01");
            $("#Customs_Date_BG").datebox("setValue", "");
            $("#Pieces_BG").numberbox("setValue", "");
            $("#Weight_BG").numberbox("setValue", "");
            $("#Volume_BG").numberbox("setValue", "");
            $("#IS_Checked_BG").prop("checked",false);
            $("#Check_QTY").datebox("setValue", "");
            //$("#Check_Date").numberbox("setValue", "");
        }
    }


    //鼠标移动离开超链接时，隐藏删除按钮
    function displeyImg(img) {
        var $id = $("#" + img);
        $id.attr("style", "visibility:hidden");
        // document.all(img).style.visibility='hidden';
    }
    //鼠标移动到超链接时，显示删除按钮
    function imgblur(img) {
        var $id = $("#" + img);
        $id.attr("style", "visibility:visible");
        //document.all(img).style.visibility="visible";
    }
    //点击删除按钮，删除该按钮对应的上传的附档图片
    function deletepicture(nowId) {//Delete

        var url = '/Pictures/Delete?id=' + nowId;
        $.ajax({
            type: 'POST',
            url: url,//获取数据的函数
            async: true,//true 异步，false 同步
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            beforeSend: function (xhr) {//发送请求前运行的函数
                //console.log('beforeSend');
                $.messager.progress({
                    title: '数据处理中',
                    msg: '数据处理中，请等待...'
                });
                AddAjaxActionGuidName(this);
            },
            success: function (data) {//查询成功,data为返回的数据
                if (data.Success) {
                    //$.messager.alert("提示", "删除成功！", "info");
                    window.location.reload();//刷新当前页面
                }
                else {
                    var ErrMsgStr = data.ErrMsg;
                    if (!(typeof (data.ErrMsg) === 'undefined' || data.ErrMsg == null || data.ErrMsg == ''))
                        ErrMsgStr = data.ErrMsg;
                    $.messager.alert("错误", ErrMsgStr, 'error');
                }
            },
            error: function () {//查询失败
                $.messager.alert("错误", "提交错误了！", 'error');
            },
            complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
                $.messager.progress('close');
            }
        });
    }

    function importexcel() {
        $('#importwindow').window('open');
    }

    function exportexcel() {
        var opts = $dg.datagrid('options');
        //var filterRules = JSON.stringify(opts.filterRules);
        //$.messager.progress({ title: '正在执行导出！' });
        //var formData = new FormData();
        //formData.append('filterRules', filterRules);
        //formData.append('sort', 'Id');
        //formData.append('order', 'asc');
        //$.postDownload('/CustomsInspections/ExportExcel', formData, function (fileName) {
        //	$.messager.progress('close');
        //});

        var formData = { filterRules: opts.filterRules,sort:opts.sortName,order:opts.sortOrder };
        var url = '/CustomsInspections/ExportExcel';
        $.DownLoadProgress({
            url: url,         //下载文件的url
            method: 'Post',   //链接打开方式
            data: postdata,         //要发送的数据
            downLoadInfo: '下载文件', //下载界面文字
            closeDelay: 2000, //自动关闭时间(毫秒) 0则立马关闭
            callbackFuc: function () {
                $.messager.progress('close');
            }
        });
    }

    var $dg = $('#customsinspection_datagrid');
    var editIndex = undefined;

    function reload() {
        reject();//回滚所有变更
        $dg.datagrid('reload');
    }

    //combogrid 设置信息（onBeginEdit时,使用）
    var combogrid_Settings = {
        'COUNTRY': {
            required: true,
            url: '/PARA_COUNTRYS/GetPagerPARA_COUNTRY',
            method: 'get',
            delay: 500,
            multiple: false,
            panelHeight: 'auto',
            panelWidth: 205,
            idField: 'COUNTRY_CO',
            valueField: 'COUNTRY_CO',
            textField: 'COUNTRY_NA',
            pageSize: 10,//每页显示的记录条数，默认为10
            pageList: [5, 10, 20],//可以设置每页记录条数的列表
            pagination: true,//是否分页
            columns: [[
                { field: 'COUNTRY_CO', title: '代码', width: 53 },
                { field: 'COUNTRY_NA', title: '名称', width: 150 }
            ]],
            onLoadSuccess: function () {
                ondgLoadSuccess($dg, 'COUNTRY', rowIndex);
            },
            onChange: function(value){
                var targetEditor = $dg.datagrid('getEditor', {
                    field: 'COUNTRY',
                    index: editIndex
                });
                if (targetEditor != null) {
                    var Selted = $(targetEditor.target).combogrid('grid').datagrid('getSelected');
                    if (Selted) {
                        var datarow = $dg.datagrid('getData').rows[editIndex];
                        if (!(typeof datarow === 'undefined' || datarow == null)) {
                            datarow['COUNTRY'+'NAME'] = Selted[$(targetEditor.target).combogrid('options').textField];
                        }
                    }
                }
            },
            keyHandler: {
                up: function (e) {
                    combogrid_upKey(this, e);
                },
                down: function (e) {
                    combogrid_downKey(this, e);
                },
                enter: function (e) {
                    combogrid_enterKey(this, e, $dg, 'COUNTRY', rowIndex);
                },
                query: function (q) {
                    combogrid_query(this, q, rowIndex, {});
                }
            }
        }
    };

    //开始编辑行时，赋值 联动数据
    function onBeginEdit(rowIndex, rowData) {
        var num = 0;
        var regx = /^\/Date\([0-9]+(\)\/)$/g;
        for (var i in rowData) {
            if (regx.test(rowData[i])) {
                rowData[i] = datetimeformatter(rowData[i]);
            }
            var targetEditor = $dg.datagrid('getEditor', {
                field: i,
                index: rowIndex
            });
            //console.log("targetEditor", i, targetEditor);
            if (targetEditor) {
                num++;
                if (num == 1 && $(targetEditor.target).val() == '') {
                    $(targetEditor.target).parent().children("span:eq(0)").children("input:eq(0)").focus();
                }

                var OldVal = targetEditor.oldHtml;
                switch (targetEditor.type.toLowerCase()) {
                    case "combogrid":
                        //console.log(targetEditor);
                        var combogrid_Setting = combogrid_Settings[targetEditor.field];
                        if (combogrid_Setting) {
                            $(targetEditor.target).combogrid(combogrid_Setting);
                        }
                        if (!(typeof(OldVal) === 'undefined'|| OldVal == null || OldVal == '')) {
                            if (rowData[targetEditor.field]) {
                                OldVal = rowData[targetEditor.field];
                            }
                            $(targetEditor.target).combogrid('setValue', OldVal);
                            var opts = $(targetEditor.target).combogrid('options');
                            var url = opts.url;
                            //设置查询参数
                            var queryParams = {
                                page: 1,
                                rows: opts.pageSize,
                                q: OldVal
                            };
                            $(targetEditor.target).combogrid('grid').datagrid('load', queryParams);
                        }
                        break;
                    case "combobox":
                        var opts = $(targetEditor.target).combobox({
                            inputEvents: $.extend({}, $.fn.combobox.defaults.inputEvents, {
                                keydown: function (event) {
                                    combobox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                    case "textbox":
                        $(targetEditor.target).textbox({
                            inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                keydown: function (event) {
                                    Listtextbox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        break;
                    case "numberbox":
                        $(targetEditor.target).numberbox({
                            inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                keydown: function (event) {
                                    Listtextbox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        break;
                    case "datebox":
                        $(targetEditor.target).datebox({
                            inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                keydown: function (event) {
                                    Listtextbox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                    case "datetimebox":
                        $(targetEditor.target).datetimebox({
                            inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                keydown: function (event) {
                                    Listtextbox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                    case "checkbox":
                        $(targetEditor.target).keydown(function (e) {
                            chk_rdo_keydown(this, e, $dg, rowIndex);
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                    case "radio":
                        $(targetEditor.target).keydown(function (e) {
                            chk_rdo_keydown(this, e, $dg, rowIndex);
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                }
            }
        }
    }

    function endEditing() {
        if (editIndex == undefined)
            return true;
        if ($dg.datagrid('validateRow', editIndex)) {
            $dg.datagrid('endEdit', editIndex);
            editIndex = undefined;
            return true;
        } else {
            return false;
        }
    }

    function onClickCell(index, field) {
        var _operates = ["_operate1", "_operate2", "_operate3", "ck"]
        if ($.inArray(field, _operates) >= 0) {
            return;
        }
        if (editIndex != index) {
            if (endEditing()) {
                    @if (!Html.IsAuthorize("CustomsInspections", "Index", "Edit"))
                    {
                        @Html.Raw("$.messager.alert('提示', '您没有编辑权限！');");
                        @Html.Raw("return;\r\n");
                    }
					//动态设置 编辑样式
                    var byteColumn = $dg.datagrid('getColumnOption', 'ADDWHO');
					if(!(typeof(byteColumn)==='undefined'||byteColumn==null||byteColumn=='')){
						byteColumn.editor = {};
						byteColumn = $dg.datagrid('getColumnOption', 'ADDTS');
						byteColumn.editor = {};
						var byteColumn = $dg.datagrid('getColumnOption', 'EDITWHO');
						byteColumn.editor = {
						    type: 'textbox',
						    options: {
						        required: false,
						        validType: 'length[0,20]'
						    }
						};
						byteColumn = $dg.datagrid('getColumnOption', 'EDITTS');
						byteColumn.editor = {
						    type: 'datebox',
						    options: {
						        required: false
						    }
						};
					}

                    //$dg.datagrid('selectRow', index).datagrid('beginEdit', index);
                    var ed = $dg.datagrid('getEditor', { index: index, field: field });
                    if (ed) {
                        ($(ed.target).data('textbox') ? $(ed.target).textbox('textbox') : $(ed.target)).focus();
                    }
                    editIndex = index;
                } else {
                    $dg.datagrid('selectRow', editIndex);
                }
            }
        }

		//加载成功
		function onLoadSuccess(rowdata) {
		    //行号自适应宽度
		    $(this).datagrid("fixRownumber");
		    loadingdata();
		}

        function append() {
            //if (endEditing()) {
            //    var NewRow = {};
            //    var Columns = $dg.datagrid('getColumnFields');
            //    for (var column in Columns) {
            //        NewRow[Columns[column]] = null;
            //    }
			//	//动态设置 编辑样式
            //    var byteColumn = $dg.datagrid('getColumnOption', 'ADDWHO');
			//	if(!(typeof(byteColumn)==='undefined'||byteColumn==null||byteColumn=='')){
			//		byteColumn.editor = {
			//		    type: 'textbox',
			//		    options: {
			//		        required: false,
			//		        validType: 'length[0,20]'
			//		    }
			//		};
			//		byteColumn = $dg.datagrid('getColumnOption', 'ADDTS');
			//		byteColumn.editor = {
			//		    type: 'datebox',
			//		    options: {
			//		        required: false
			//		    }
			//		};
			//		byteColumn = $dg.datagrid('getColumnOption', 'EDITWHO');
			//		byteColumn.editor = {};
			//		byteColumn = $dg.datagrid('getColumnOption', 'EDITTS');
			//		byteColumn.editor = {};
			//	}
			//	//$dg.datagrid('insertRow', { index: 0, row: NewRow });
			//	editIndex = 0 ;
            //    $dg.datagrid('selectRow', editIndex).datagrid('beginEdit', editIndex);
            //}
        }

        //function onDblClickRow(index, row) {
        //    //var row = $dg.datagrid('getSelected');
        //    $(location).attr('href', "/CustomsInspections/Edit?id=" + row.Id);
        //}

        function removeit() {
			var Seltdata = $dg.datagrid('getSelections');
			if (!(typeof editIndex === 'undefined'|| editIndex ==null || isNaN(editIndex)))
			{
			    $dg.datagrid('cancelEdit', editIndex);
			    editIndex = undefined;
			}
			for (var i = Seltdata.length; i > 0; i--) {
			    var rowindex = $dg.datagrid('getRowIndex', Seltdata[i - 1]);
			    //console.log(rowindex);
			    $dg.datagrid('deleteRow', rowindex);
			}
        }

        function getSelectDatagrid(rows) {
            var ids = [];
            for (var i = 0; i < rows.length; i++) {
                ids.push(rows[i].Id);
            }
            return ids;
        }

        function removeIt() {
            var rows = $dg.datagrid('getSelections');
            if (rows.length == 0) {
                $.messager.alert("提示", "请选择需要删除的报关信息！");
                return false;
            }
            $.messager.confirm('确认对话框', '您确认删除所有选中信息！', function (r) {
                if (r) {
                    var ids = getSelectDatagrid(rows);
                    if (ids.length > 0) {
                        SaveDelete(ids);
                        window.location.reload();//刷新当前页面
                        //loadingdata();
                    }
                    //console.log(ids.length);
                }
            });
        }

        function SaveDelete(ids) {
            var IDS = JSON.stringify(ids);
            //console.log('IDS', IDS);
            var url = '/CustomsInspections/SaveDelete?ids=' + ids;
            $.ajax({
                type: 'POST',
                url: url,//获取数据的函数
                async: true,//true 异步，false 同步
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {//发送请求前运行的函数
                    //console.log('beforeSend');
                    $.messager.progress({
                        title: '数据处理中',
                        msg: '数据处理中，请等待...'
                    });
                    AddAjaxActionGuidName(this);
                },
                success: function (data) {//查询成功,data为返回的数据
                    if (data.Success) {
                        //$.messager.alert("提示", "提交成功！", "info");
                        $dg.datagrid('reload');
                        $dg.datagrid('clearSelections');
                    }
                    else {
                        var ErrMsgStr = '提交错误了！';
                        if (!(typeof (data.ErrMsg) === 'undefined' || data.ErrMsg == null || data.ErrMsg == ''))
                            ErrMsgStr = data.ErrMsg;
                        $.messager.alert("错误", ErrMsgStr, 'error');
                    }
                },
                error: function () {//查询失败
                    $.messager.alert("错误", "提交错误了！", 'error');
                },
                complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
                    $.messager.progress('close');
                }
            });
        }

        function accept() {
            if (endEditing()) {
                if ($dg.datagrid('getChanges').length) {
                    var inserted = $dg.datagrid('getChanges', "inserted");
                    var deleted = $dg.datagrid('getChanges', "deleted");
                    var updated = $dg.datagrid('getChanges', "updated");
                    var effectRow = new Object();
                    if (inserted.length) {
                        effectRow.inserted = inserted;
                    }
                    if (deleted.length) {
                        effectRow.deleted = deleted;
                    }
                    if (updated.length) {
                        effectRow.updated = updated;
                    }
                    //console.log(JSON.stringify(effectRow));
					var url = '/CustomsInspections/SaveData';
					$.ajax({
                        type: 'POST',
                        url: url,//获取数据的函数
                        async: true,//true 异步，false 同步
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify(effectRow),//查询条件JSON.stringify()
                        beforeSend: function (xhr) {//发送请求前运行的函数
                            $.messager.progress({
                                title: '数据处理中',
                                msg: '数据处理中，请等待...'
                            });
                            //验证重复提交时 请加上 这句
                            AddAjaxActionGuidName(this);
                        },
                        success: function (response) {//查询成功,data为返回的数据
                            if (response.Success) {
                                $.messager.alert("提示", "提交成功！");
                                $dg.datagrid('acceptChanges');
                                $dg.datagrid('reload');
                            }
                            else {
								var ErrMsgStr = '提交错误了！';
								if(!(typeof(response.ErrMsg) === 'undefined' || response.ErrMsg == null || response.ErrMsg == ''))
									ErrMsgStr = response.ErrMsg;
                                $.messager.alert("错误", ErrMsgStr, 'error');
                            }
                        },
                        error: function () {//查询失败
                            $.messager.alert("错误", "提交错误了！", 'error');
                        },
                        complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
                            $.messager.progress('close');
                        }
                    });
                }
                //$dg.datagrid('acceptChanges');
            }
        }

        function reject() {
            $dg.datagrid('rejectChanges');
            editIndex = undefined;
        }

        function getChanges() {
            var rows = $dg.datagrid('getChanges');
            alert(rows.length + ' rows are changed!');
        }

		//自动添加 textbox 或 text的值
		function AutoAddFilterRule($dg_)
		{
		    var ColumnsFields =$dg_.datagrid('getColumnFields');
		    $.each(ColumnsFields,function(i,ColumnName){
		        var input = $dg_.datagrid('getFilterComponent', ColumnName);
		        if(!(input.data("datebox") ||input.data("datetimebox") || input.data("combobox")|| input.data("checkbox") || input.data("combotree")|| input.data("combogrid") || input.data("numberbox"))){
		            var rule = $dg_.datagrid('getFilterRule',  ColumnName);
		            var value = input.val();
		            if (!(typeof(value)==='undefined'||value==null || value == '')) {
		                if ((rule && rule.value != value) || !rule) {
		                    $dg_.datagrid('addFilterRule', {
		                        field: ColumnName,
		                        op: 'equal',
		                        value: value
		                    });
		                }
		            } else {
		                if (rule) {
		                    $dg_.datagrid('removeFilterRule', ColumnName);
		                }
		            }
		        }
		    });
		}

		//-----------------------------------------------------
		//datagrid onSelect
		//-----------------------------------------------------
		function onSelect(index, row) {
		    var rows = $dg.datagrid('getSelected');
		    //console.log(rows);
		    //console.log(rows.IS_Checked_BG);
		    //console.log(rows.Id);
		    //var customsdatebg=GetDateFormat(rows.Customs_Date_BG);
		    var CustomsDatebg = dateformatter(rows.Customs_Date_BG);
		    var FlightDateWant = dateformatter(rows.Flight_Date_Want);
		    var CheckQTY = dateformatter(rows.Check_QTY);
		    //console.log(rows.IS_Checked_BG);
		    //console.log(CustomsDatebg);
		    //console.log(rows.Id);
		    $("#Id").val(rows.Id);
		    $("#Operation_ID").textbox("setValue", rows.Operation_ID);
		    $("#Flight_NO").textbox("setValue", rows.Flight_NO);
		    $("#MBL").textbox("setValue", rows.MBL);
		    //$("#Flight_Date_Want").datetimebox("setValue", FlightDateWant);
		    $("#Consign_Code_CK").combogrid("setValue", rows.Consign_Code_CK);
		    $("#Book_Flat_Code").combogrid("setValue", rows.Book_Flat_Code);
		    $("#Customs_Declaration").combogrid("setValue", rows.Customs_Declaration);
		    $("#Num_BG").numberbox("setValue", rows.Num_BG);
		    $("#Remarks_BG").textbox("setValue", rows.Remarks_BG);
		    $("#Customs_Broker_BG").textbox("setValue", rows.Customs_Broker_BG);
		    $("#Customs_Date_BG").datebox("setValue", CustomsDatebg);
		    $("#Pieces_TS").numberbox("setValue", rows.Pieces_TS);
		    $("#Weight_TS").numberbox("setValue", rows.Weight_TS);
		    $("#Volume_TS").numberbox("setValue", rows.Volume_TS);
		    $("#Pieces_Fact").numberbox("setValue", rows.Pieces_Fact);
		    $("#Weight_Fact").numberbox("setValue", rows.Weight_Fact);
		    $("#Volume_Fact").numberbox("setValue", rows.Volume_Fact);
		    $("#Pieces_BG").numberbox("setValue", rows.Pieces_BG);
		    $("#Weight_BG").numberbox("setValue", rows.Weight_BG);
		    $("#Volume_BG").numberbox("setValue", rows.Volume_BG);
		    $("#IS_Checked_BG").prop("checked", rows.IS_Checked_BG);
		    $("#Check_Date").numberbox("setValue", rows.Check_Date);
		    $("#Check_QTY").datebox("setValue", CheckQTY);
		}

		//自适应页面大小
		function MyNavResize() {
		    var opts = $("#navbar-minimalize").NavResize('getOptions');
		    opts.Auto = false;
		    opts.OnNavResizefunc = function () {
		        //$("#edit_div_one").css('width', "100%");
		        //$("#edit_div_two").css('width', "100%");
		        //$("#OrderInfo").datagrid("resize", { width: "100%" });
		        //$("#OrderDetail").datagrid("resize", { width: "100%" });
		        //$("#ProductNameMerge").datagrid("resize", { width: "100%" });
		        //$("#Order_Head_panel").panel("resize", { width: "100%" });
		        //setTimeout(function () {
		        //    var paddigLeftRight = { "padding-left": "0px", "margin-left": "0px", "padding-right": "0px", "margin-right": "0px" };
		        //    $("#edit_div_one").css(paddigLeftRight);
		        //    $("#edit_div_two").css(paddigLeftRight);
		        //    $("#OrderInfo").css(paddigLeftRight);
		        //    $("#OrderDetail").css(paddigLeftRight);
		        //    $("#ProductNameMerge").css(paddigLeftRight);
		        //    $("#Order_Head_panel").css(paddigLeftRight);
		        //    SetbuttonssWidth();
		        //}, 100);
		    };
		}

		function initbindingcombogrid() {
		    //委托方
		    $("#Consign_Code_CK").combogrid($.extend({}, combogrid_DefaultSettings, {
		        idField: 'ID',
		        valueField: 'ID',
		        textField: 'TEXT',
		        url1: '/CusBusInfos/GetPagerCusBusInfos_FromCache',
		    }));

		    //订舱方
		    $("#Book_Flat_Code").combogrid($.extend({}, combogrid_DefaultSettings, {
		        idField: 'ID',
		        valueField: 'ID',
		        textField: 'TEXT',
		        url1: '/CusBusInfos/GetPagerCusBusInfos_FromCache',
		    }));

		    //报关方式
		    $("#Customs_Declaration").combogrid($.extend({}, combogrid_DefaultSettings, {
		        idField: 'ID',
		        valueField: 'ID',
		        textField: 'TEXT',
		        url: '/BD_DEFDOC_LISTs/GetPager_DEFDOC_DICT_FromCache?DOCCODE=CusType',
		        onChange: function (newval,oldval) {
		            //var Customs_Date_BG = $("#Customs_Date_BG").datebox("getValue");
		            //if (typeof (Customs_Date_BG) === 'undefined' || Customs_Date_BG == null || Customs_Date_BG == "") {
		            //    //$("#Customs_Date_BG").datebox("setValue", "2018");//默认日期
		            //}
		            var $Customs_Broker_BG = $("#Customs_Broker_BG");
		            if(newval==1||newval==2){
		                if($Customs_Broker_BG.length>0){
		                    $Customs_Broker_BG.combogrid("setValue","XBDW001");
		                    $Customs_Broker_BG.combogrid("setText","鑫巴达物流");
		                }
		            }else{
		                $Customs_Broker_BG.combogrid("setValue","");
		                $Customs_Broker_BG.combogrid("setText","");
		            }
		        }
		    }));
		    //报关方
		    $("#Customs_Broker_BG").combogrid($.extend({}, combogrid_DefaultSettings, {
		        idField: 'ID',
		        valueField: 'ID',
		        textField: 'TEXT',
		        url1: '/CusBusInfos/GetPagerCusBusInfos_FromCache',
		    }));
		}

		//报关方式
		function CusTypeformatter(value, row, index) {
		    try {
		        if (value == 1)
		            return '普货';
		        if (value == 2)
		            return '一体化';
		        if (value == 3)
		            return '自报';
                if (value == 4)
                    return '自交';
		        return value;
		    }
		    catch (e) {
		        return value;
		    }
		}
        //保存编辑
		function SaveEdit() {
		    newCustomsInspection = getCusInfoData();
		    $.ajax({
		        url: '/CustomsInspections/SaveAppend',
		        type: "POST",
		        dataType: "json",
		        contentType: "application/json; charset=utf-8",
		        data: JSON.stringify({ CustomsInspection: newCustomsInspection }),//JSON.stringify()
		        success: function (result) {
		            //console.log("result.success:",result.success);
		            if (result.success = true) {
		                //$.messager.alert("提示", "保存成功！");
		                //$("#Customs_Declaration").combogrid("setValue", "");
		                //$("#Num_BG").textbox("setValue", "");
		                //$("#Remarks_BG").textbox("setValue", "");
		                //$("#Customs_Broker_BG").textbox("setValue", ""),
                        //$("#Customs_Date_BG").datebox("setValue", ""),
                        //$("#Pieces_BG").numberbox("setValue", ""),
                        //$("#Weight_BG").numberbox("setValue", ""),
                        //$("#Volume_BG").numberbox("setValue", ""),
                        //$("#IS_Checked_BG").removeAttr("checked");
		                //$("#Check_QTY").datebox("setValue", ""),
                        //$("#Check_Date").numberbox("setValue", ""),
                        // $("#Fileupload").textbox("setValue", ""),
		                //reload();
		                //loadingdata();
		                window.location.reload();//刷新当前页面
		                return true;
		            } else {
		                $.messager.alert("err", result.err);
		                return false;
		            }
		        },
		        error: function (result) {
		            return false;
		        }
		    });
		    //$("#Saveeidt").attr("disabled", "disabled");
		    $("#customsinspection_datagrid").datagrid("clearChecked");
		    $('#customsinspection_datagrid').datagrid('clearSelections');
		}
		function getCusInfoData(){

		    var newCustomsInspection = {
		        Id: $("#Id").val(),
		        Operation_ID: $("#Operation_ID").textbox("getValue"),
		        Flight_NO: $("#Flight_NO").textbox("getValue"),
		        Flight_Date_Want: $("#Flight_Date_Want").datebox("getValue"),
		        MBL: $("#MBL").textbox("getValue"),
		        Consign_Code_CK: $("#Consign_Code_CK").textbox("getValue"),
		        Book_Flat_Code: $("#Book_Flat_Code").combogrid("getValue"),
		        Customs_Declaration: $("#Customs_Declaration").combogrid("getValue"),
		        Num_BG: $("#Num_BG").numberbox("getValue"),
		        Remarks_BG: $("#Remarks_BG").textbox("getValue"),
		        Customs_Broker_BG: $("#Customs_Broker_BG").textbox("getValue"),
		        Customs_Date_BG: $("#Customs_Date_BG").datebox("getValue"),
		        Pieces_TS: $("#Pieces_TS").numberbox("getValue"),
		        Weight_TS: $("#Weight_TS").numberbox("getValue"),
		        Volume_TS: $("#Volume_TS").numberbox("getValue"),
		        Pieces_Fact: $("#Pieces_Fact").numberbox("getValue"),
		        Weight_Fact: $("#Weight_Fact").numberbox("getValue"),
		        Volume_Fact: $("#Volume_Fact").numberbox("getValue"),
		        Pieces_BG: $("#Pieces_BG").numberbox("getValue"),
		        Weight_BG: $("#Weight_BG").numberbox("getValue"),
		        Volume_BG: $("#Volume_BG").numberbox("getValue"),
		        IS_Checked_BG: $("#IS_Checked_BG").get(0).checked,
		        Check_QTY: $("#Check_QTY").datebox("getValue"),
		        Check_Date: $("#Check_Date").numberbox("getValue"),
		    };
		    return newCustomsInspection;
		}
		//jquery获取当前时间并且格式化
		Date.prototype.Format = function (fmt) {
		    var o = {
		        "M+": this.getMonth() + 1, //月份
		        "d+": this.getDate(), //日
		        "H+": this.getHours(), //小时
		        "m+": this.getMinutes(), //分
		        "s+": this.getSeconds(), //秒
		        "q+": Math.floor((this.getMonth() + 3) / 3), //季度
		        "S": this.getMilliseconds() //毫秒
		    };
		    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
		    for (var k in o)
		        if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
		    return fmt;
		}

        //新增报关信息
		function AppendCusInfo() {

		    $("#Id").val("0");
		    $("#Customs_Declaration").combogrid("setValue",  "");
		    $("#Num_BG").textbox("setValue", "");
		    $("#Remarks_BG").textbox("setValue", "");
		    $("#Customs_Broker_BG").textbox("setValue", "");
		    var nowdate = new Date().Format("yyyy-MM-dd HH:mm:ss");
		    $("#Customs_Date_BG").datebox("setValue", nowdate);

		    //$("#Pieces_BG").numberbox("setValue", "");
		    //$("#Weight_BG").numberbox("setValue", "");
		    //$("#Volume_BG").numberbox("setValue", "");

		    //$("#IS_Checked_BG").prop("checked",false);
		    //$("#Check_QTY").datebox("setValue", "");
		    //$("#Check_Date").numberbox("setValue", "");

		    //var aaa = $('form').serializeArray();
		    //var Id = $("#Id").val()
		    //console.log(Id);
		    //aaa.splice(0,1,"");
		    //console.log(aaa);
		    //var formobject = {};
		    //formobject["Operation_ID"] = $("#Operation_ID").textbox("getValue");
		    //formobject["Flight_NO"] = $("#Flight_NO").textbox("getValue");
		    //formobject["MBL"] = $("#MBL").textbox("getValue");
		    //formobject["Flight_Date_Want"] = $("#Flight_Date_Want").datebox("getValue");
		    //formobject["Consign_Code_CK"] = $("#Consign_Code_CK").combogrid("getValue");
		    //formobject["Book_Flat_Code"] = $("#Book_Flat_Code").combogrid("getValue");
		    //$.each(aaa, function (i, item) {
		    //    formobject[item.name] = item.value;
		    //});

		    //console.log(formobject);
		    //$.ajax({
		    //    url: '/CustomsInspections/SaveAppend',
		    //    type: "Post",
		    //    dataType: "json",
		    //    contentType: "application/json;charset=utf-8",
		    //    data: JSON.stringify(formobject),
		    //    success: function (result) {
		    //        console.log("result.success:", result.success);
		    //        if (result.success = true) {
		    //            $.messager.alert("提示", "新增成功");
		    //                //$("#Customs_Declaration").combogrid("setValue","");
		    //                //$("#Num_BG").textbox("setValue","");
		    //                //$("#Remarks_BG").textbox("setValue","");
		    //                //$("#Customs_Broker_BG").textbox("setValue",""),
            //                //$("#Customs_Date_BG").datebox("setValue",""),
            //                //$("#Pieces_BG").numberbox("setValue",""),
            //                //$("#Weight_BG").numberbox("setValue",""),
            //                //$("#Volume_BG").numberbox("setValue",""),
            //                //$("#IS_Checked_BG").removeAttr("checked");
		    //                //$("#Check_QTY").datebox("setValue",""),
            //                //$("#Check_Date").numberbox("setValue", ""),
            //                //$("#Fileupload").textbox("setValue", ""),
		    //            //reload();
		    //            //loadingdata();
		    //            window.location.reload();//刷新当前页面
		    //            return true;
		    //        } else {
		    //            $.messager.alert("提示", "保存失败");
		    //        }
		    //    }
		    //})
		}

        //点击行，数据填充form
		function onClickRow() {
		    var rows = $dg.datagrid('getSelected');
		    //console.log(rows);
		    //console.log(rows.IS_Checked_BG);
		    //console.log(rows.Id);
		    //var customsdatebg=GetDateFormat(rows.Customs_Date_BG);
		    var CustomsDatebg = dateformatter(rows.Customs_Date_BG);
		    var FlightDateWant = dateformatter(rows.Flight_Date_Want);
		    var CheckQTY = dateformatter(rows.Check_QTY);
		    //console.log(rows.IS_Checked_BG);
		    //console.log(CustomsDatebg);
		    //console.log(rows.Id);
		    $("#Id").val(rows.Id);
		    $("#Operation_ID").textbox("setValue", rows.Operation_ID);
		    $("#Flight_NO").textbox("setValue", rows.Flight_NO);
		    $("#MBL").textbox("setValue", rows.MBL);
		    //$("#Flight_Date_Want").datetimebox("setValue", FlightDateWant);
		    $("#Consign_Code_CK").textbox("setValue", rows.Consign_Code_CK);
		    $("#Book_Flat_Code").combogrid("setValue", rows.Book_Flat_Code);
		    $("#Customs_Declaration").combogrid("setValue", rows.Customs_Declaration);
		    $("#Num_BG").numberbox("setValue", rows.Num_BG);
		    $("#Remarks_BG").textbox("setValue", rows.Remarks_BG);
		    $("#Customs_Broker_BG").textbox("setValue", rows.Customs_Broker_BG);
		    $("#Customs_Date_BG").datebox("setValue", CustomsDatebg);
		    $("#Pieces_TS").numberbox("setValue", rows.Pieces_TS);
		    $("#Weight_TS").numberbox("setValue", rows.Weight_TS);
		    $("#Volume_TS").numberbox("setValue", rows.Volume_TS);
		    $("#Pieces_Fact").numberbox("setValue", rows.Pieces_Fact);
		    $("#Weight_Fact").numberbox("setValue", rows.Weight_Fact);
		    $("#Volume_Fact").numberbox("setValue", rows.Volume_Fact);
		    $("#Pieces_BG").numberbox("setValue", rows.Pieces_BG);
		    $("#Weight_BG").numberbox("setValue", rows.Weight_BG);
		    $("#Volume_BG").numberbox("setValue", rows.Volume_BG);
		    $("#IS_Checked_BG").prop("checked", rows.IS_Checked_BG);
		    $("#Check_Date").numberbox("setValue", rows.Check_Date);
		    $("#Check_QTY").datebox("setValue", CheckQTY);

		}

		function ToOP_EN() {
		    var operationid = $("#Operation_ID").textbox("getValue");
		    $(location).attr('href',  "/OPS_M_Orders/Edit?id="  + @ViewBag.MBLId);
		    //$(location).attr('href', "/CustomsInspections/CusIndex?OPS_ENid="+getQueryString("id"));

        }

		function ToCusIndex(id) {
		    $(location).attr('href', "/CustomsInspections/CusIndex?OPS_ENid=" + getQueryString("id"));
		}

		function ToDocMent1(id) {
		    var rowdata = $dg.datagrid('getSelections');
		    if (rowdata.length == 0) {
		        var Operation_ID = $("#Operation_ID").textbox("getValue");
		        $(location).attr('href', "/DocumentManagements/Index?id=0&Operation_ID=" + Operation_ID);
		        //$.messager.alert("提示", "请选择一条信息!");
		    }
		     else {
		        var rowdata = $dg.datagrid('getSelected');
		        var id = rowdata.Id;
		        var Operation_ID = rowdata.Operation_Id;
		        $(location).attr('href', "/DocumentManagements/Index?id=" + id);

		    }

		}


    </script>
}

