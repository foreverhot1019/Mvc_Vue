@model AirOut.Web.Models.DocumentManagement
@{
    ViewBag.Title = "单证管理";
	var Num = 1;
    var CusIns = ViewBag.CusInsData;
    var OPS_ENid = ViewBag.OPS_ENid;
    var Entrustment_Code = ViewBag.Entrustment_Code;
    var MBLId = ViewBag.OPS_Mid;
}
<!--DataGrid 回车Editor下一个 和 为控件添加 Key事件 -->
@*<script async defer type="text/javascript" src="~/Scripts/EasyUIDataGrid_ControlNext.js"></script>*@
<!--真实 下载进度条 -->
<script async defer src="~/Scripts/DownLoadProgress.js"></script>

<script src="~/Scripts/jsext.js"></script>
<script type="text/javascript">
    //表单唯一值，防止重复提交
    var ActionGuidName = '@(ViewData["ActionGuidName"]??"")';
    var ActionGuid = '@(ViewData["ActionGuidName"] == null ? "" : (ViewData[ViewData["ActionGuidName"].ToString()] ?? ""))';
</script>

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>@ViewBag.Title</h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Index", "Home")">主页</a>
            </li>
            <li>
                <a href="#">空运承揽</a>
            </li>
            <li class="active">
                <strong>@ViewBag.Title</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
	<div class="row">
	    <div class="col-lg-12">
	        <div class="ibox float-e-margins">
	            @*<div class="ibox-title">
	                <div class="ibox-tools">
	                    <a class="collapse-link">
	                        <i class="fa fa-chevron-up"></i>
	                    </a>
						
	                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
	                        <i class="fa fa-wrench"></i>
	                    </a>
	                    <ul class="dropdown-menu dropdown-user">
	                        <li>
	                            <a href="table_data_tables.html#">Config option 1</a>
	                        </li>
	                        <li>
	                            <a href="table_data_tables.html#">Config option 2</a>
	                        </li>
	                    </ul>
	                    <a class="close-link">
	                        <i class="fa fa-times"></i>
	                    </a>
						
	                </div>
	            </div>*@
	            <div class="ibox-content">
	                <!--<form id="searchform" method="post" style="padding-bottom:10px; width:auto">
                        <div id="div_search" style="padding-top:5px; padding-bottom:3px; width:auto;" class="easyui-panel" title="查询条件"
                             data-options="collapsible:true">
                            <div class="form-group col-md-3">
                                <label for="name">进出口标志:</label>
                                <input id="I_E_FLAG" name="I_E_FLAG" tabindex="@(Num++)" data-options="prompt1:'进出口标志'" style="width:100%" class="easyui-combogrid" type="text" />
                            </div>
                            <div class="form-group col-md-3">
                                <label for="name">接单日期起:</label>
                                <input id="_ADDTS" name="_ADDTS" tabindex="@(Num++)" data-options="prompt1:'接单日期起'" style="width:100%" class="easyui-datebox" type="text" />
                            </div>
                            <div class="form-group col-md-3">
                                <label for="name">接单日期讫:</label>
                                <input id="ADDTS_" name="ADDTS_" tabindex="@(Num++)" data-options="prompt1:'接单日期讫'" style="width:100%" class="easyui-datebox" type="text" />
                            </div>
                            <div class="form-group col-md-3">
                                <label for="name">预关务流水号:</label>
                                <input id="Yucustomsflowno" name="Yucustomsflowno" tabindex="@(Num++)" data-options="prompt1:'预关务流水号'" style="width:100%" class="easyui-textbox" type="text" />
                            </div>
                        </div>
                    </form>-->
                    <div id="CusIndex_panel" class="easyui-panel" title="单证管理" style="width:100%;height:auto;padding:10px;"
                         data-options="collapsible:true">
                        <div class="col-lg-12">
                            @*<button type="button" onclick="javascript:history.back(-1)">返回</button>*@
                            @*<button type="button" id="Saveeidt" onclick="SaveEdit()">保存</button>*@
                            <button type="button" onclick="ToCusIns()">报关信息</button>
                            <button type="button" onclick="javascript:window.location.href='/OPS_M_Orders/WarehouseSee?MBL=-1&MBLId='+$('#MBLId').val();">仓库信息</button>
                            <button type="button" onclick="ToOP_EN()">接单信息</button>
                            <button type="button" onclick="javascript:window.location.href='/Bms_Bill_Aps/BmsBillApView?OPS_M_OrdId=' + $('#MBLId').val();">结算信息</button>
                        </div>
                        <form id="DocMent_form" style="margin-left: auto;margin-right: auto;" data-options="collapsible:true">
                            <div class="form-group col-md-12">
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">业务编号:</label>
                                    <input id="CuOperation_ID" name="Operation_ID" tabindex="@(Num++)" data-options="prompt1:'业务编号'" style="width:70%" class="easyui-textbox" type="text" value="@ViewBag.CusInsData.Operation_ID" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">航班:</label>
                                    <input id="Flight_NO" name="Flight_NO" tabindex="@(Num++)" data-options="prompt1:'航班'" style="width:70%" class="easyui-textbox" type="text" value="@ViewBag.CusInsData.Flight_NO" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">总单号:</label>
                                    <input id="MBL" name="MBL" tabindex="@(Num++)" data-options="prompt1:'总单号'" style="width:70%" class="easyui-textbox" type="text" value="@ViewBag.CusInsData.MBL" />
                                    <input id="MBLId" name="MBLId" hidden  type="text" value="@MBLId" />
                                </div>
                            </div>
                            <div class="form-group col-md-12">
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">航班时间:</label>
                                    <input id="Flight_Date_Want" name="Flight_Date_Want" tabindex="@(Num++)" data-options="prompt1:'航班时间'" style="width:70%" class="easyui-datebox" type="text" value='@(ViewBag.CusInsData == null ? "" : (ViewBag.CusInsData.Flight_Date_Want == null ? "" : ((DateTime)ViewBag.CusInsData.Flight_Date_Want).ToString("yyyy-MM-dd")))' />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">委托方:</label>
                                    <input id="Consign_Code_CK" name="Consign_Code_CK" tabindex="@(Num++)" disabled="disabled" data-options="prompt1:'委托方'" style="width:70%" class="easyui-combogrid" type="text" value="@ViewBag.CusInsData.Consign_Code_CK" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">订舱方:</label>
                                    <input id="Book_Flat_Code" name="Book_Flat_Code" tabindex="@(Num++)" disabled="disabled" data-options="prompt1:'订舱方'" style="width:70%" class="easyui-combogrid" type="text" value="@ViewBag.CusInsData.Book_Flat_Code" />
                                </div>
                            </div>
                            <div class="form-group col-md-12">
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">报关方式:</label>
                                    <input id="Customs_Declaration" name="Customs_Declaration" tabindex="@(Num++)" disabled="disabled" data-options="prompt1:'报关方式'" style="width:70%" class="easyui-combogrid" type="text" value="@ViewBag.CusInsData.Customs_Declaration" />
                                </div>
                                @*<div class="form-group col-md-4">
                        <label for="name" style="width:20%">票数:</label>
                        <input id="Num_BG" name="Num_BG" tabindex="@(Num++)" data-options="prompt1:'票数'" style="width:70%" class="easyui-numberbox" type="text" value="" />
                    </div>
                    <div class="form-group col-md-4">
                        <label for="name" style="width:20%">备注:</label>
                        <input id="Remarks_BG" name="Remarks_BG" tabindex="@(Num++)" data-options="prompt1:'备注'" style="width:70%" class="easyui-textbox" type="text" value="" />
                    </div>*@
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">报关方:</label>
                                    <input id="Customs_Broker_BG" name="Customs_Broker_BG" tabindex="@(Num++)" disabled="disabled" data-options="prompt1:'报关方'" style="width:70%" class="easyui-combogrid" type="text" value="@ViewBag.CusInsData.Customs_Broker_BG" />
                                </div>
                                @*<div class="form-group col-md-4">
                        <label for="name" style="width:20%">报关日期:</label>
                        <input id="Customs_Date_BG" name="Customs_Date_BG" tabindex="@(Num++)" data-options="prompt1:'报关日期'" style="width:70%" class="easyui-datetimebox" type="text" value="" />
                    </div>*@
                                <div class="form-group col-md-4">
                                </div>
                            </div>
                            <div class="form-group col-md-12">
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">托书件数:</label>
                                    <input id="Pieces_TS" name="Pieces_TS" tabindex="@(Num++)" data-options="prompt1:'进仓件数'" style="width:70%" class="easyui-numberbox" type="text" value="@ViewBag.CusInsData.Pieces_TS" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">托书毛重:</label>
                                    <input id="Weight_TS" name="Weight_TS" tabindex="@(Num++)" data-options="prompt1:'进仓毛重'" style="width:70%" class="easyui-numberbox" type="text" value="@ViewBag.CusInsData.Weight_TS" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">托书体积:</label>
                                    <input id="Volume_TS" name="Volume_TS" tabindex="@(Num++)" data-options="prompt1:'进仓体积'" style="width:70%" class="easyui-numberbox" type="text" value="@ViewBag.CusInsData.Volume_TS" />
                                </div>
                            </div>
                            @*<div class="form-group col-md-4">
                    <label for="name" style="width:20%">进仓件数:</label>
                    <input id="Pieces_Fact" name="Pieces_Fact" tabindex="@(Num++)" data-options="prompt1:'托书件数'" style="width:70%" class="easyui-numberbox" type="text" value="" />
                </div>
                <div class="form-group col-md-4">
                    <label for="name" style="width:20%">进仓毛重:</label>
                    <input id="Weight_Fact" name="Weight_Fact" tabindex="@(Num++)" data-options="prompt1:'托书毛重'" style="width:70%" class="easyui-numberbox" type="text" value="" />
                </div>
                <div class="form-group col-md-4">
                    <label for="name" style="width:20%">进仓体积:</label>
                    <input id="Volume_Fact" name="Volume_Fact" tabindex="@(Num++)" data-options="prompt1:'托书体积'" style="width:70%" class="easyui-numberbox" type="text" value="" />
                </div>*@
                            <div class="form-group col-md-12">
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">报关件数:</label>
                                    <input id="Pieces_BG" name="Pieces_BG" tabindex="@(Num++)" data-options="prompt1:'报关件数'" style="width:70%" class="easyui-numberbox" type="text" value="@ViewBag.CusInsData.Pieces_BG" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">报关毛重:</label>
                                    <input id="Weight_BG" name="Weight_BG" tabindex="@(Num++)" data-options="prompt1:'报关毛重'" style="width:70%" class="easyui-numberbox" type="text" value="@ViewBag.CusInsData.Weight_BG" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">报关体积:</label>
                                    <input id="Volume_BG" name="Volume_BG" tabindex="@(Num++)" data-options="prompt1:'报关体积'" style="width:70%" class="easyui-numberbox" type="text" value="@ViewBag.CusInsData.Volume_BG" />
                                </div>
                            </div>
                            <div class="form-group col-md-12">
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">海关查检:</label>
                                    <input id="IS_Checked_BG" name="IS_Checked_BG" tabindex="@(Num++)" data-options="prompt1:'海关查检'" style="width:70%" class="easyui-checkbox" type="checkbox" disabled="disabled" value="" checked="@ViewBag.CusInsData.IS_Checked_BG" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">海关查检日期:</label>
                                    <input id="Check_QTY" name="Check_QTY" tabindex="@(Num++)" data-options="prompt1:'海关查检日期'" style="width:70%" class="easyui-datebox" type="text" value="@ViewBag.CusInsData.Check_QTY" />
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="name" style="width:20%">海关查检次数:</label>
                                    <input id="Check_Date" name="Check_Date" tabindex="@(Num++)" data-options="prompt1:'报关体积'" style="width:70%" class="easyui-numberbox" type="text" value="@ViewBag.CusInsData.Check_Date" />
                                </div>
                            </div>
                        </form>
                        @*<div hidden>
                <form id="searchform" method="post" style="padding-bottom:10px; width:auto">
                    <div id="div_search" style="padding-top:5px; padding-bottom:3px; width:auto;" class="easyui-panel" title="查询条件"
                         data-options="collapsible:true">
                        <div class="form-group col-md-3">
                            <label for="name">业务编号:</label>
                            <input id="Operation_IDQuery" name="Operation_IDQuery" tabindex="@(Num++)" data-options="prompt1:'业务编号'" style="width:100%" class="easyui-textbox" type="text" />
                        </div>
                    </div>
                </form>
            </div>*@
                    </div>
					<div class="table-responsive">
                        <table id="documentmanagement_datagrid" class="easyui-datagrid" title="" style="width:auto;height:auto"
                               data-options="
							rownumbers:true,
							checkOnSelect:true,
							selectOnCheck:true,
							idField:'Id',
							sortName:'Id',
							sortOrder:'desc',
							remoteFilter: true,
							singleSelect: true,
							toolbar: '#documentmanagement_toolbar',
							url: '',
							method: 'get',
							onClickCell: onClickCell,
							onSelect:onSelect,
							pagination: 'true',
                            onBeginEdit:onBeginEdit,
                            onDblClickRow:onDblClickRow">
                            <thead>
                                <tr>
                                    <th data-options="field:'ck',checkbox:true"></th>
                                    @*<th data-options="field:'Id',width:80 ,sortable:true,resizable:true ">@Html.DisplayNameFor(model => model.Id)</th>*@
                                    <th data-options="field:'Operation_ID',width:140,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}" hidden>@Html.DisplayNameFor(model => model.Operation_ID)</th>
                                    <th data-options="field:'DZ_Type',width:140,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}" hidden>@Html.DisplayNameFor(model => model.DZ_Type)</th>
                                <th data-options="field:'Doc_NO',width:140,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">海关编号</th>
                                <th data-options="field:'Trade_Mode',width:140,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.Trade_Mode)</th>
                                <th data-options="field:'Return_Print',width:100,align:'right',sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false
										}
								}">@Html.DisplayNameFor(model => model.Return_Print)</th>
                                <th data-options="field:'QTY',width:100,align:'right',sortable:true,resizable:true,
									editor:{
										type:'numberbox',
										options:{
											required:false
										}
								}">@Html.DisplayNameFor(model => model.QTY)</th>
                                <th data-options="field:'BG_TT',width:140,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.BG_TT)</th>
                                <th data-options="field:'Ping_Name',width:140,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.Ping_Name)</th>
                                <th data-options="field:'Return_Date',width:160,align:'right',sortable:true,resizable:true,
									formatter:dateformatter,
									editor:{
										type:'datebox',
										options:{
											required:false
										}
								}">@Html.DisplayNameFor(model => model.Return_Date)</th>
                                <th data-options="field:'Print_Date',width:160,align:'right',sortable:true,resizable:true,
									formatter:dateformatter,
									editor:{
										type:'datebox',
										options:{
											required:false
										}
								}">@Html.DisplayNameFor(model => model.Print_Date)</th>
                                <th data-options="field:'Return_Customer_Date',width:160,align:'right',sortable:true,resizable:true,
									formatter:dateformatter,
									editor:{
										type:'datebox',
										options:{
											required:false
										}
								}">@Html.DisplayNameFor(model => model.Return_Customer_Date)</th>
                            </tr>
                        </thead>
                    </table>
					<div id="documentmanagement_toolbar" style="height:auto">
						@if (Html.IsAuthorize("OPS_M_Orders", "Create", "Create"))
						{
						    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-plus',plain:true" onclick="append()">新增</a>
                            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-copy',plain:true" onclick="copyit()">复制</a>
                        }
						@if (Html.IsAuthorize("OPS_M_Orders", "Delete", "Delete"))
						{
							<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" onclick="removeit()">删除</a>
						}
                        @*<a id="button103" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-download-alt',plain:true" onclick="exportexcel_Doc()">导出</a>*@
						@*@if (Html.IsAuthorize("Edit"))
						{
						    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true" onclick="accept()">保存</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-refresh',plain:true" onclick="reload()">刷新</a>
						}
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-undo',plain:true" onclick="reject()">取消</a>
						@if (Html.IsAuthorize("Import"))
						{
							<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-paperclip',plain:true" onclick="importexcel()">EXCEL 导入</a>
							<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-download-alt',plain:true" onclick="exportexcel()">导出 Excel</a>
						}*@
						@*<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-plus',plain:true" onclick="append()">新增</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" onclick="removeit()">删除</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true" onclick="accept()">保存</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-undo',plain:true" onclick="reject()">取消</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-paperclip',plain:true" onclick="importexcel()">EXCEL 导入</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-download-alt',plain:true" onclick="exportexcel()">导出 Excel</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-refresh',plain:true" onclick="reload()">刷新</a>*@
					</div>
				</div>
				<!-- end ibox-content -->
	            </div>
	        </div>
	    </div>
	</div>
</div>

<div id="DocMentWin" class="easyui-window" title="单证管理" data-options="modal:true,collapsible:false,resizable:false,minimizable:false,maximizable:false,closed:true,iconCls:'icon-paperclip'" style="width:60%;height:40%;padding:10px;">
    <form id="DocMentWin_form" style="margin-left: auto;margin-right: auto;" data-options="collapsible:true">
        <input id="Id" name="Id" tabindex="@(Num++)" data-options="prompt1:''" style="width:70%" class="easyui-textbox" type="hidden"  />
        <div class="form-group col-md-6" hidden>
            <label for="name" style="width:20%">业务编号:</label>
            <input id="Operation_ID" name="Operation_ID" tabindex="@(Num++)" data-options="prompt1:'业务编号'" style="width:70%" class="easyui-textbox" type="text" value="@ViewBag.CusInsData.Operation_ID"/>
        </div>
        <div class="form-group col-md-6" hidden>
            <label for="name" style="width:20%">单证类型:</label>
            <input id="DZ_Type" name="DZ_Type" tabindex="@(Num++)" data-options="prompt1:'单证类型'" style="width:70%" class="easyui-textbox" type="text" />
        </div>
        <div class="form-group col-md-6">
            <label for="name" style="width:20%" >海关编号:</label>
            <input id="Doc_NO" name="Doc_NO" tabindex="@(Num++)" data-options="prompt1:'单证编号'" style="width:70%" class="easyui-textbox" type="text" />
        </div>
        <div class="form-group col-md-6">
            <label for="name" style="width:20%">贸易方式:</label>
            <input id="Trade_Mode" name="Trade_Mode" tabindex="@(Num++)" data-options="prompt1:'贸易方式'" style="width:70%" class="easyui-combogrid" type="text" />
        </div>
        <div class="form-group col-md-6">
            <label for="name" style="width:20%">退单打印份数:</label>
            <input id="Return_Print" name="Return_Print" tabindex="@(Num++)" data-options="prompt1:'贸易方式'" style="width:70%" class="easyui-textbox" type="text" />
        </div>
        <div class="form-group col-md-6">
            <label for="name" style="width:20%">联单数:</label>
            <input id="QTY" name="QTY" tabindex="@(Num++)" data-options="prompt1:'贸易方式'" style="width:70%" class="easyui-numberbox" type="text" />
        </div>
        <div class="form-group col-md-6">
            <label for="name" style="width:20%">拼号:</label>
            <input id="Ping_Name" name="Ping_Name" tabindex="@(Num++)" data-options="prompt1:'贸易方式'" style="width:70%" class="easyui-textbox" type="text" />
        </div>
        <div class="form-group col-md-6">
            <label for="name" style="width:20%">报关抬头:</label>
            <input id="BG_TT" name="BG_TT" tabindex="@(Num++)" data-options="prompt1:'贸易方式'" style="width:70%" class="easyui-textbox" type="text" />
        </div>
    </form>
    <div class="form-group col-lg-12">
        <button class="btn btn-primary" type="button" id="SaveIt" onclick="AppendDocMent()">保存</button>
        <button class="btn btn-primary" type="button" id="OpenIt" onclick="CloseIt()">关闭</button>
        <button class="btn btn-primary" type="button" id="refresh" onclick="AppendDocMent2()">刷新</button>
    </div>
</div>

<div id="importwindow" class="easyui-window" title="Excel 导入"   data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,closed:true,iconCls:'icon-paperclip'" style="width:500px;height:260px;padding:10px;">
    <p><input type="file" name="file_upload" id="file_upload" /></p>
</div>

@section Scripts {
    <script type="text/javascript">
    function AppendDocMent()
    {
        var Doc_NO = $("#Doc_NO","#DocMentWin_form").textbox("getValue");
        if(Doc_NO.length != 18){
            $.messager.alert("提示", "海关编码必须为18位,当前为"+Doc_NO.length+"位!");
            $("#Doc_NO","#DocMentWin_form").textbox('textbox').focus();
            return;
        }
        var aaa = $("#DocMentWin_form").serializeArray();
        var formobject = {};
        $.each(aaa, function (i, item) {
            formobject[item.name] = item.value;
        });
        formobject["Flight_Date_Want"] = $("#Flight_Date_Want").datebox("getValue");
        formobject["Entrustment_Name"] = $("#Consign_Code_CK").combogrid("getValue");
        formobject["Entrustment_Code"] = '@ViewBag.Entrustment_Code';
        formobject["MBL"] = $("#MBL").textbox("getValue");
        formobject[""]
        //console.log(formobject);
        $.ajax({
            url: '/DocumentManagements/SaveAppend',
            type: "Post",
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(formobject),
            success: function (result) {
                console.log(result);
                if (result.success == "false") {
                    $.messager.alert("提示", result.ErrMsg);
                    console.log(result);
                }
                else{
                    $.messager.alert("提示", "新增成功");
                    console.log(result);
                    $("#DocMentWin").window("close");
                    reload();
                    return true;
                }
            }
        })
    }

    function AppendDocMent2() {
        var Doc_NO = $("#Doc_NO","#DocMentWin_form").textbox("getValue");
        if(Doc_NO.length != 18){
            $.messager.alert("提示", "海关编码必须为18位,当前为"+Doc_NO.length+"位!");
            $("#Doc_NO","#DocMentWin_form").textbox('textbox').focus();
            return;
        }
        var newDocumentManagement = {
            Id: $("#Id").val(),
            Operation_ID: $("#Operation_ID").textbox("getValue"),
            DZ_Type: $("#DZ_Type").textbox("getValue"),
            Doc_NO: $("#Doc_NO").textbox("getValue"),
            Trade_Mode: $("#Trade_Mode").combogrid("getValue"),
            Return_Print: $("#Return_Print").textbox("getValue"),
            QTY: $("#QTY").numberbox("getValue"),
            Ping_Name: $("#Ping_Name").textbox("getValue"),
            BG_TT: $("#BG_TT").textbox("getValue"),
            Flight_Date_Want: $("#Flight_Date_Want").datebox("getValue"),
            Entrustment_Name: $("#Consign_Code_CK").combogrid("getValue"),
            Entrustment_Code: '@ViewBag.Entrustment_Code',
            MBL: $("#MBL").textbox("getValue"),
        };

        $.ajax({
            url: '/DocumentManagements/SaveAppend',
            type: "Post",
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({ DocumentManagement: newDocumentManagement }),
            success: function (result) {
                console.log("result.success:", result.success);
                if (result.success) {
                    $.messager.alert("提示", "保存成功");
                    $("#DocMentWin").window("close");
                    reload();
                    return true;
                } else {
                    $.messager.alert("提示", "保存失败");
                }
            }
        })
    }

    function append(){
        $("#DocMentWin").window("open")
    }

    function onDblClickRow(index, row) {
        $("#DocMentWin").window("open")
        $("#SaveIt").attr("onclick", "AppendDocMent2();");
        var rows = $dg.datagrid('getSelected');
        console.log(row);
        //$("#Operation_ID").textbox("Operation_ID", row.Operation_ID);
        $("#Id").val(row.Id);
        $("#DZ_Type").textbox("setValue", row.DZ_Type);
        $("#Doc_NO").textbox("setValue", row.Doc_NO);
        $("#Trade_Mode").combogrid("setValue", row.Trade_Mode);
        $("#Return_Print").textbox("setValue", row.Return_Print);
        $("#QTY").numberbox("setValue", row.QTY);
        $("#Ping_Name").textbox("setValue", row.Ping_Name);
        $("#BG_TT").textbox("setValue", row.BG_TT);
        console.log($("#Id").val());
    }

    function CloseIt() {
        $("#DocMentWin").window("close");
    }

    $(function () {
        $("#file_upload").uploadifive({
            'height': 30,
            'fileTypeDesc': 'Excel 2010 Files',
            'fileTypeExts': '*.xlsx',
            'uploadScript': '/FileUpload/Upload',
            'buttonText': '选择EXCEL',
            'multi': true,
            'displayData': 'speed',
            'formData': { 'modelType': 'DocumentManagement' },
            'width': 120,
            'successTimeout': 100000,
            'onFallback': function () {
                $.messager.alert('导入错误', '导入错误，请重试！<br>', 'error');
                $('#file_upload').uploadifive('clearQueue')
            },
            'onSelect': function (queue) {
                $.messager.progress({
                    title: '执行导入',
                    msg: '请等待...'
                });
            },
            'onUploadComplete': function (file, data) {
                $.messager.progress('close');
                var data = $.parseJSON(data);
                //console.log(data);
                if (data.success == false) {
                    $.messager.alert('导入错误', '导入错误，请修改后再倒入！<br>' + data.message, 'error');
                    $("#file_upload").uploadifive('clearQueue')
                } else {
                    $.messager.alert('导入完成', '导入完成！<br>', 'info');
                    $dg.datagrid('reload');
                    $('#importwindow').window('close');
                }
                return true;
                //alert('The file ' + file.name + ' was successfully uploaded with a response of ' + response + ':' + data);
            }
        });
    });


    function importexcel() {
        $('#importwindow').window('open');
    }

    function exportexcel() {
        var opts = $dg.datagrid('options');
        //var filterRules = JSON.stringify(opts.filterRules);
        //$.messager.progress({ title: '正在执行导出！' });
        //var formData = new FormData();
        //formData.append('filterRules', filterRules);
        //formData.append('sort', 'Id');
        //formData.append('order', 'asc');
        //$.postDownload('/DocumentManagements/ExportExcel', formData, function (fileName) {
        //	$.messager.progress('close');
        //});

        var formData = { filterRules: opts.filterRules,sort:opts.sortName,order:opts.sortOrder };
        var url = '/DocumentManagements/ExportExcel';
        $.DownLoadProgress({
            url: url,         //下载文件的url
            method: 'Post',   //链接打开方式
            data: postdata,         //要发送的数据
            downLoadInfo: '下载文件', //下载界面文字
            closeDelay: 2000, //自动关闭时间(毫秒) 0则立马关闭
            callbackFuc: function () {
                $.messager.progress('close');
            }
        });
    }

    var $dg = $('#documentmanagement_datagrid');
    var editIndex = undefined;

    function reload() {
        reject();//回滚所有变更
        $dg.datagrid('reload');
    }

    //combogrid 设置信息（onBeginEdit时,使用）
    var combogrid_Settings = {
        'COUNTRY': {
            required: true,
            url: '/PARA_COUNTRYS/GetPagerPARA_COUNTRY',
            method: 'get',
            delay: 500,
            multiple: false,
            panelHeight: 'auto',
            panelWidth: 205,
            idField: 'COUNTRY_CO',
            valueField: 'COUNTRY_CO',
            textField: 'COUNTRY_NA',
            pageSize: 10,//每页显示的记录条数，默认为10
            pageList: [5, 10, 20],//可以设置每页记录条数的列表
            pagination: true,//是否分页
            columns: [[
                { field: 'COUNTRY_CO', title: '代码', width: 53 },
                { field: 'COUNTRY_NA', title: '名称', width: 150 }
            ]],
            onLoadSuccess: function () {
                ondgLoadSuccess($dg, 'COUNTRY', rowIndex);
            },
            onChange: function(value){
                var targetEditor = $dg.datagrid('getEditor', {
                    field: 'COUNTRY',
                    index: editIndex
                });
                if (targetEditor != null) {
                    var Selted = $(targetEditor.target).combogrid('grid').datagrid('getSelected');
                    if (Selted) {
                        var datarow = $dg.datagrid('getData').rows[editIndex];
                        if (!(typeof datarow === 'undefined' || datarow == null)) {
                            datarow['COUNTRY'+'NAME'] = Selted[$(targetEditor.target).combogrid('options').textField];
                        }
                    }
                }
            },
            keyHandler: {
                up: function (e) {
                    combogrid_upKey(this, e);
                },
                down: function (e) {
                    combogrid_downKey(this, e);
                },
                enter: function (e) {
                    combogrid_enterKey(this, e, $dg, 'COUNTRY', rowIndex);
                },
                query: function (q) {
                    combogrid_query(this, q, rowIndex, {});
                }
            }
        }
    };

    //开始编辑行时，赋值 联动数据
    function onBeginEdit(rowIndex, rowData) {
        var num = 0;
        var regx = /^\/Date\([0-9]+(\)\/)$/g;
        for (var i in rowData) {
            if (regx.test(rowData[i])) {
                rowData[i] = datetimeformatter(rowData[i]);
            }
            var targetEditor = $dg.datagrid('getEditor', {
                field: i,
                index: rowIndex
            });
            //console.log("targetEditor", i, targetEditor);
            if (targetEditor) {
                num++;
                if (num == 1 && $(targetEditor.target).val() == '') {
                    $(targetEditor.target).parent().children("span:eq(0)").children("input:eq(0)").focus();
                }

                var OldVal = targetEditor.oldHtml;
                switch (targetEditor.type.toLowerCase()) {
                    case "combogrid":
                        //console.log(targetEditor);
                        var combogrid_Setting = combogrid_Settings[targetEditor.field];
                        if (combogrid_Setting) {
                            $(targetEditor.target).combogrid(combogrid_Setting);
                        }
                        if (!(typeof(OldVal) === 'undefined'|| OldVal == null || OldVal == '')) {
                            if (rowData[targetEditor.field]) {
                                OldVal = rowData[targetEditor.field];
                            }
                            $(targetEditor.target).combogrid('setValue', OldVal);
                            var opts = $(targetEditor.target).combogrid('options');
                            var url = opts.url;
                            //设置查询参数
                            var queryParams = {
                                page: 1,
                                rows: opts.pageSize,
                                q: OldVal
                            };
                            $(targetEditor.target).combogrid('grid').datagrid('load', queryParams);
                        }
                        break;
                    case "combobox":
                        var opts = $(targetEditor.target).combobox({
                            inputEvents: $.extend({}, $.fn.combobox.defaults.inputEvents, {
                                keydown: function (event) {
                                    combobox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                    case "textbox":
                        $(targetEditor.target).textbox({
                            inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                keydown: function (event) {
                                    Listtextbox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        break;
                    case "numberbox":
                        $(targetEditor.target).numberbox({
                            inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                keydown: function (event) {
                                    Listtextbox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        break;
                    case "datebox":
                        $(targetEditor.target).datebox({
                            inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                keydown: function (event) {
                                    Listtextbox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                    case "datetimebox":
                        $(targetEditor.target).datetimebox({
                            inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                keydown: function (event) {
                                    Listtextbox_keydown(this, event, $dg, rowIndex);
                                }
                            })
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                    case "checkbox":
                        $(targetEditor.target).keydown(function (e) {
                            chk_rdo_keydown(this, e, $dg, rowIndex);
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                    case "radio":
                        $(targetEditor.target).keydown(function (e) {
                            chk_rdo_keydown(this, e, $dg, rowIndex);
                        });
                        setTargetVal(targetEditor, OldVal);
                        break;
                }
            }
        }
    }

    function endEditing() {
        if (editIndex == undefined)
            return true;
        if ($dg.datagrid('validateRow', editIndex)) {
            $dg.datagrid('endEdit', editIndex);
            editIndex = undefined;
            return true;
        } else {
            return false;
        }
    }

    function onClickCell(index, field) {
        var _operates = ["_operate1", "_operate2", "_operate3", "ck"]
        if ($.inArray(field, _operates) >= 0) {
            return;
        }
        if (editIndex != index) {
            if (endEditing()) {
                @if (!Html.IsAuthorize("DocumentManagements", "Index", "Edit"))
                    {
                        @Html.Raw("$.messager.alert('提示', '您没有编辑权限！');");
                        @Html.Raw("return;\r\n");
                    }
                //动态设置 编辑样式
                var byteColumn = $dg.datagrid('getColumnOption', 'ADDWHO');
                if(!(typeof(byteColumn)==='undefined'||byteColumn==null||byteColumn=='')){
                    byteColumn.editor = {};
                    byteColumn = $dg.datagrid('getColumnOption', 'ADDTS');
                    byteColumn.editor = {};
                    var byteColumn = $dg.datagrid('getColumnOption', 'EDITWHO');
                    byteColumn.editor = {
                        type: 'textbox',
                        options: {
                            required: false,
                            validType: 'length[0,20]'
                        }
                    };
                    byteColumn = $dg.datagrid('getColumnOption', 'EDITTS');
                    byteColumn.editor = {
                        type: 'datebox',
                        options: {
                            required: false
                        }
                    };
                }

                //$dg.datagrid('selectRow', index).datagrid('beginEdit', index);
                var ed = $dg.datagrid('getEditor', { index: index, field: field });
                if (ed) {
                    ($(ed.target).data('textbox') ? $(ed.target).textbox('textbox') : $(ed.target)).focus();
                }
                editIndex = index;
            } else {
                $dg.datagrid('selectRow', editIndex);
            }
        }
    }

    //加载成功
    function onLoadSuccess(rowdata) {
        //行号自适应宽度
        $(this).datagrid("fixRownumber");
    }

    //function append() {
    //    if (endEditing()) {
    //        var NewRow = {};
    //        var Columns = $dg.datagrid('getColumnFields');
    //        for (var column in Columns) {
    //            NewRow[Columns[column]] = null;
    //        }
    //		//动态设置 编辑样式
    //        var byteColumn = $dg.datagrid('getColumnOption', 'ADDWHO');
    //		if(!(typeof(byteColumn)==='undefined'||byteColumn==null||byteColumn=='')){
    //			byteColumn.editor = {
    //			    type: 'textbox',
    //			    options: {
    //			        required: false,
    //			        validType: 'length[0,20]'
    //			    }
    //			};
    //			byteColumn = $dg.datagrid('getColumnOption', 'ADDTS');
    //			byteColumn.editor = {
    //			    type: 'datebox',
    //			    options: {
    //			        required: false
    //			    }
    //			};
    //			byteColumn = $dg.datagrid('getColumnOption', 'EDITWHO');
    //			byteColumn.editor = {};
    //			byteColumn = $dg.datagrid('getColumnOption', 'EDITTS');
    //			byteColumn.editor = {};
    //		}
    //		$dg.datagrid('insertRow', { index: 0, row: NewRow });
    //		editIndex = 0 ;
    //        $dg.datagrid('selectRow', editIndex).datagrid('beginEdit', editIndex);
    //    }
    //}

    function removeit() {
        var Seltdata = $dg.datagrid('getSelections');
        if (!(typeof editIndex === 'undefined'|| editIndex ==null || isNaN(editIndex)))
        {
            $dg.datagrid('cancelEdit', editIndex);
            editIndex = undefined;
        }
        for (var i = Seltdata.length; i > 0; i--) {
            var rowindex = $dg.datagrid('getRowIndex', Seltdata[i - 1]);
            //console.log(rowindex);
            $dg.datagrid('deleteRow', rowindex);
        }
        if (endEditing()) {
            if ($dg.datagrid('getChanges').length) {
                var inserted = $dg.datagrid('getChanges', "inserted");
                var deleted = $dg.datagrid('getChanges', "deleted");
                var updated = $dg.datagrid('getChanges', "updated");
                var effectRow = new Object();
                if (inserted.length) {
                    effectRow.inserted = inserted;
                }
                if (deleted.length) {
                    effectRow.deleted = deleted;
                }
                if (updated.length) {
                    effectRow.updated = updated;
                }
                //console.log(JSON.stringify(effectRow));
                var url = '/DocumentManagements/SaveData';
                $.ajax({
                    type: 'POST',
                    url: url,//获取数据的函数
                    async: true,//true 异步，false 同步
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(effectRow),//查询条件JSON.stringify()
                    beforeSend: function (xhr) {//发送请求前运行的函数
                        $.messager.progress({
                            title: '数据处理中',
                            msg: '数据处理中，请等待...'
                        });
                        //验证重复提交时 请加上 这句
                        AddAjaxActionGuidName(this);
                    },
                    success: function (response) {//查询成功,data为返回的数据
                        if (response.Success) {
                            $.messager.alert("提示", "提交成功！");
                            $dg.datagrid('acceptChanges');
                            $dg.datagrid('reload');
                        }
                        else {
                            var ErrMsgStr = '提交错误了！';
                            if (!(typeof (response.ErrMsg) === 'undefined' || response.ErrMsg == null || response.ErrMsg == ''))
                                ErrMsgStr = response.ErrMsg;
                            $.messager.alert("错误", ErrMsgStr, 'error');
                        }
                    },
                    error: function () {//查询失败
                        $.messager.alert("错误", "提交错误了！", 'error');
                    },
                    complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
                        $.messager.progress('close');
                    }
                });
            }
            //$dg.datagrid('acceptChanges');
        }
    }

    //function accept() {
    //    if (endEditing()) {
    //        if ($dg.datagrid('getChanges').length) {
    //            var inserted = $dg.datagrid('getChanges', "inserted");
    //            var deleted = $dg.datagrid('getChanges', "deleted");
    //            var updated = $dg.datagrid('getChanges', "updated");
    //            var effectRow = new Object();
    //            if (inserted.length) {
    //                effectRow.inserted = inserted;
    //            }
    //            if (deleted.length) {
    //                effectRow.deleted = deleted;
    //            }
    //            if (updated.length) {
    //                effectRow.updated = updated;
    //            }
    //            //console.log(JSON.stringify(effectRow));
    //            var url = '/DocumentManagements/SaveData';
    //            $.ajax({
    //                type: 'POST',
    //                url: url,//获取数据的函数
    //                async: true,//true 异步，false 同步
    //                dataType: "json",
    //                contentType: "application/json; charset=utf-8",
    //                data: JSON.stringify(effectRow),//查询条件JSON.stringify()
    //                beforeSend: function (xhr) {//发送请求前运行的函数
    //                    $.messager.progress({
    //                        title: '数据处理中',
    //                        msg: '数据处理中，请等待...'
    //                    });
    //                    //验证重复提交时 请加上 这句
    //                    AddAjaxActionGuidName(this);
    //                },
    //                success: function (response) {//查询成功,data为返回的数据
    //                    if (response.Success) {
    //                        $.messager.alert("提示", "提交成功！");
    //                        $dg.datagrid('acceptChanges');
    //                        $dg.datagrid('reload');
    //                    }
    //                    else {
    //                        var ErrMsgStr = '提交错误了！';
    //                        if(!(typeof(response.ErrMsg) === 'undefined' || response.ErrMsg == null || response.ErrMsg == ''))
    //                            ErrMsgStr = response.ErrMsg;
    //                        $.messager.alert("错误", ErrMsgStr, 'error');
    //                    }
    //                },
    //                error: function () {//查询失败
    //                    $.messager.alert("错误", "提交错误了！", 'error');
    //                },
    //                complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
    //                    $.messager.progress('close');
    //                }
    //            });
    //        }
    //        //$dg.datagrid('acceptChanges');
    //    }
    //}

    function reject() {
        $dg.datagrid('rejectChanges');
        editIndex = undefined;
    }

    function getChanges() {
        var rows = $dg.datagrid('getChanges');
        alert(rows.length + ' rows are changed!');
    }

    $(function () {
        //$dg.datagrid('enableFilter',[
        // 	{
        //           field: 'Return_Date',
        //           type: 'datebox',
        //           options: {
        //               onChange: function (value) {
        //                   if (value == '') {
        //                       $dg.datagrid('removeFilterRule', 'Return_Date');
        //                   } else {
        //                       $dg.datagrid('addFilterRule', {
        //                           field: 'Return_Date',
        //                           op: 'equal',
        //                           value: value
        //                       });
        //                   }
        // 				  //自动添加 textbox 或 text的值
        //                   //AutoAddFilterRule($dg);
        //                   $dg.datagrid('doFilter');
        //               }
        //           }
        //     },
        // 	{
        //           field: 'Print_Date',
        //           type: 'datebox',
        //           options: {
        //               onChange: function (value) {
        //                   if (value == '') {
        //                       $dg.datagrid('removeFilterRule', 'Print_Date');
        //                   } else {
        //                       $dg.datagrid('addFilterRule', {
        //                           field: 'Print_Date',
        //                           op: 'equal',
        //                           value: value
        //                       });
        //                   }
        // 				  //自动添加 textbox 或 text的值
        //                   //AutoAddFilterRule($dg);
        //                   $dg.datagrid('doFilter');
        //               }
        //           }
        //     },
        // 	{
        //           field: 'Return_Customer_Date',
        //           type: 'datebox',
        //           options: {
        //               onChange: function (value) {
        //                   if (value == '') {
        //                       $dg.datagrid('removeFilterRule', 'Return_Customer_Date');
        //                   } else {
        //                       $dg.datagrid('addFilterRule', {
        //                           field: 'Return_Customer_Date',
        //                           op: 'equal',
        //                           value: value
        //                       });
        //                   }
        // 				  //自动添加 textbox 或 text的值
        //                   //AutoAddFilterRule($dg);
        //                   $dg.datagrid('doFilter');
        //               }
        //           }
        //     },
        // 	{
        // 		field: 'Status',
        // 		type: 'combobox',
        // 		options: {
        // 			panelHeight: 'auto',
        //             data: [
        // 				{ value: '', text: 'All' },
        // 				{ value: 'true', text: '启用' },
        // 				{ value: 'false', text: '停用' }
        // 			],
        //             onChange: function (value) {
        //                 if (value == '') {
        //                     $dg.datagrid('removeFilterRule', 'Status');
        //                 } else {
        //                     $dg.datagrid('addFilterRule', {
        //                         field: 'Status',
        //                         op: 'equal',
        //                         value: value
        //                     });
        //                 }
        // 				//自动添加 textbox 或 text的值
        //                 //AutoAddFilterRule($dg);
        //                 $dg.datagrid('doFilter');
        // 			}
        // 		}
        // 	},
        // 	{
        //           field: 'ADDTS',
        //           type: 'datebox',
        //           options: {
        //               onChange: function (value) {
        //                   if (value == '') {
        //                       $dg.datagrid('removeFilterRule', 'ADDTS');
        //                   } else {
        //                       $dg.datagrid('addFilterRule', {
        //                           field: 'ADDTS',
        //                           op: 'equal',
        //                           value: value
        //                       });
        //                   }
        // 				  //自动添加 textbox 或 text的值
        //                   //AutoAddFilterRule($dg);
        //                   $dg.datagrid('doFilter');
        //               }
        //           }
        //     },
        // 	{
        //           field: 'EDITTS',
        //           type: 'datebox',
        //           options: {
        //               onChange: function (value) {
        //                   if (value == '') {
        //                       $dg.datagrid('removeFilterRule', 'EDITTS');
        //                   } else {
        //                       $dg.datagrid('addFilterRule', {
        //                           field: 'EDITTS',
        //                           op: 'equal',
        //                           value: value
        //                       });
        //                   }
        // 				  //自动添加 textbox 或 text的值
        //                   //AutoAddFilterRule($dg);
        //                   $dg.datagrid('doFilter');
        //               }
        //           }
        //     },
        //     //{
        //     //    field: 'UNIT',
        //     //    type: 'combogrid',
        //     //    options: {
        //     //        url: '/PARA_UNITS/GetPagerPARA_UNIT',
        //     //        method: 'get',
        //     //        multiple: false,
        //     //        panelHeight: 'auto',
        //     //        panelWidth: 205,
        //     //        idField: 'UNIT_CODE',
        //     //        valueField: 'UNIT_CODE',
        //     //        textField: 'UNIT_NAME',
        //     //        pageSize: 10,//每页显示的记录条数，默认为10
        //     //        pageList: [5, 10, 20],//可以设置每页记录条数的列表
        //     //        pagination: true,//是否分页
        //     //        columns: [[
        //     //            { field: 'UNIT_CODE', title: '代码', width: 53 },
        //     //            { field: 'UNIT_NAME', title: '名称', width: 150 }
        //     //        ]],
        //     //        keyHandler: {
        //     //            up: function (e) {
        //     //                combogrid_upKey(this, e);
        //     //            },
        //     //            down: function (e) {
        //     //                combogrid_downKey(this, e);
        //     //            },
        //     //            enter: function (e) {
        //     //                combogrid_enterKey(this, e, $dg, '', editIndex);
        //     //            },
        //     //            query: function (q) {
        //     //                combogrid_query(this, q, editIndex, {});
        //     //            }
        //     //        },
        //     //        onChange: function (value) {
        //     //            if (value == '') {
        //     //                $dg.datagrid('removeFilterRule', 'UNIT');
        //     //            } else {
        //     //                $dg.datagrid('addFilterRule', {
        //     //                    field: 'UNIT',
        //     //                    op: 'equal',
        //     //                    value: value
        //     //                });
        //     //            }
        //     //            //自动添加 textbox 或 text的值
        //     //            AutoAddFilterRule($dg);
        //     //            $dg.datagrid('doFilter');
        //     //        }
        //     //    }
        //     //},
        // ]);
    });

    //自动添加 textbox 或 text的值
    function AutoAddFilterRule($dg_)
    {
        var ColumnsFields =$dg_.datagrid('getColumnFields');
        $.each(ColumnsFields,function(i,ColumnName){
            var input = $dg_.datagrid('getFilterComponent', ColumnName);
            if(!(input.data("datebox") ||input.data("datetimebox") || input.data("combobox")|| input.data("checkbox") || input.data("combotree")|| input.data("combogrid") || input.data("numberbox"))){
                var rule = $dg_.datagrid('getFilterRule',  ColumnName);
                var value = input.val();
                if (!(typeof(value)==='undefined'||value==null || value == '')) {
                    if ((rule && rule.value != value) || !rule) {
                        $dg_.datagrid('addFilterRule', {
                            field: ColumnName,
                            op: 'equal',
                            value: value
                        });
                    }
                } else {
                    if (rule) {
                        $dg_.datagrid('removeFilterRule', ColumnName);
                    }
                }
            }
        });
    }

    //-----------------------------------------------------
    //datagrid onSelect
    //-----------------------------------------------------
    function onSelect(index, row) {
        //console.log(index, row);
    }

    //自适应页面大小
    function MyNavResize() {
        var opts = $("#navbar-minimalize").NavResize('getOptions');
        opts.Auto = false;
        opts.OnNavResizefunc = function () {
            //$("#edit_div_one").css('width', "100%");
            //$("#edit_div_two").css('width', "100%");
            //$("#OrderInfo").datagrid("resize", { width: "100%" });
            //$("#OrderDetail").datagrid("resize", { width: "100%" });
            //$("#ProductNameMerge").datagrid("resize", { width: "100%" });
            //$("#Order_Head_panel").panel("resize", { width: "100%" });
            //setTimeout(function () {
            //    var paddigLeftRight = { "padding-left": "0px", "margin-left": "0px", "padding-right": "0px", "margin-right": "0px" };
            //    $("#edit_div_one").css(paddigLeftRight);
            //    $("#edit_div_two").css(paddigLeftRight);
            //    $("#OrderInfo").css(paddigLeftRight);
            //    $("#OrderDetail").css(paddigLeftRight);
            //    $("#ProductNameMerge").css(paddigLeftRight);
            //    $("#Order_Head_panel").css(paddigLeftRight);
            //    SetbuttonssWidth();
            //}, 100);
        };
    }

    $(function () {
        $("#CuOperation_ID").textbox("disable");
        $("#Flight_NO").textbox("disable");
        $("#MBL").textbox("disable");
        $("#Flight_Date_Want").datetimebox("disable");
        $("#Book_Flat_Code").combogrid("disable");
        $("#Consign_Code_CK").combogrid("disable");
        $("#Customs_Declaration").combogrid("disable");
        $("#Customs_Broker_BG").combogrid("disable");
        $("#Pieces_TS").numberbox("disable");
        $("#Weight_TS").numberbox("disable");
        $("#Volume_TS").numberbox("disable");
        $("#Pieces_BG").numberbox("disable");
        $("#Weight_BG").numberbox("disable");
        $("#Volume_BG").numberbox("disable");
        $("#Check_QTY").datebox("disable");
        $("#Check_Date").numberbox("disable");
        //$("#IS_Checked_BG").checkbox("readonly");
        //$("input[type='checkbox']").disable(function(){
        //    this.checked = !this.checked;
        //});
    })

    $(function () {
        //报关方式
        $("#Customs_Declaration").combogrid($.extend({}, combogrid_DefaultSettings,{
            idField: 'ID',
            valueField: 'ID',
            textField: 'TEXT',
            url: '/BD_DEFDOC_LISTs/GetPager_DEFDOC_DICT_FromCache?DOCCODE=CusType',
        }));

        //贸易方式
        $("#Trade_Mode").combogrid($.extend({}, combogrid_DefaultSettings, {
            idField: 'ID',
            valueField: 'ID',
            textField: 'TEXT',
            url: '/BD_DEFDOC_LISTs/GetPager_DEFDOC_DICT_FromCache?DOCCODE=Trade_Mode',
            onChange: function(newValue, oldValue){
                var row = $("#Trade_Mode").combogrid("grid").datagrid("getSelected");
                $("#Return_Print").textbox("setValue", row.REMARK);
            }
        }));

        //订舱方
        $("#Book_Flat_Code").combogrid($.extend({}, combogrid_DefaultSettings, {
            idField: 'ID',
            valueField: 'ID',
            textField: 'TEXT',
            url: '/CusBusInfos/GetPagerCusBusInfos_FromCache',
        }));

        //委托方
        $("#Consign_Code_CK").combogrid($.extend({}, combogrid_DefaultSettings, {
            idField: 'ID',
            valueField: 'ID',
            textField: 'TEXT',
            url: '/CusBusInfos/GetPagerCusBusInfos_FromCache',
        }));

        //报关方
        $("#Customs_Broker_BG").combogrid($.extend({}, combogrid_DefaultSettings, {
            idField: 'ID',
            valueField: 'ID',
            textField: 'TEXT',
            url: '/CusBusInfos/GetPagerCusBusInfos_FromCache',
        }));
    })

    function copyit(){
        var rows = $dg.datagrid('getSelected');
        delete rows.Id
        console.log(rows);
        $.ajax({
            url: '/DocumentManagements/SaveAppend',
            type: "Post",
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(rows),
            success: function (result) {
                console.log("result.success:", result.success);
                if (result.success = true) {
                    $.messager.alert("提示", "复制成功");
                    $("#DocMentWin").window("close");
                    reload();
                    return true;
                } else {
                    $.messager.alert("提示", "复制失败");
                }
            }
        })
    }

    $(function () {
        operationid = $("#CuOperation_ID").textbox("getValue");
        //$.ajax({
        //    type: 'GET',
        //    url: '/DocumentManagements/GetData?operation_id=' + operationid,
        //    success: function () {
        //        //console.log("success");
        //    }
        //});
        $('#documentmanagement_datagrid').datagrid({ url: '/DocumentManagements/GetData?operation_id=' + operationid })
    })

    function ToCusIns() {
        $(location).attr('href', "/CustomsInspections/CusIndex?OPS_ENid=" + @ViewBag.OPS_ENid);
    }

    function ToOP_EN(){
        $(location).attr('href',  "/OPS_M_Orders/Edit?id="  + @ViewBag.OPS_Mid);
    }

    //function exportexcel_Doc()
    //{
    //    //$.messager.progress({ title: '正在执行导出！' });
    //    var inserted_Doc = $('#documentmanagement_datagrid').datagrid('getSelected');
    //    delete inserted_Doc.ADDTS;
    //    delete inserted_Doc.EDITTS;
    //    console.log(inserted_Doc);

    //        var url = '/DocumentManagements/ExportExcelDocMent';
    //        var postdata = { documentmanagement_DOC: JSON.stringify(inserted_Doc) };
    //        console.log(postdata);
    //        $.DownLoadProgress({url: url,         //下载文件的url
    //            method: 'Post',   //链接打开方式
    //            data:postdata,         //要发送的数据
    //            downLoadInfo: '下载文件', //下载界面文字
    //            closeDelay: 2000, //自动关闭时间(毫秒) 0则立马关闭
    //            callbackFuc:function(){
    //                $.messager.progress('close');
    //            }
    //        });
    //        //$.postJSONDownload(url, postdata, function (fileName) {
    //        //    $.messager.progress('close');
    //        //});


    //}
</script>
}

