@model IEnumerable<AirOut.Web.Models.OPS_EntrustmentInfor>
@{
    ViewBag.Title = "承揽接单";
    var Num = 1;
    var CusInsDataID = ViewBag.CusInsDataID;
    var CusInsData = ViewBag.CusInsData;
}
<!--DataGrid 回车Editor下一个 和 为控件添加 Key事件 -->
<script async defer type="text/javascript" src="~/Scripts/EasyUIDataGrid_ControlNext.js"></script>
<!--真实 下载进度条 -->
<script async defer src="~/Scripts/DownLoadProgress.js"></script>
<script type="text/javascript">
    //表单唯一值，防止重复提交
    var ActionGuidName = '@(ViewData["ActionGuidName"]??"")';
    var ActionGuid = '@(ViewData["ActionGuidName"] == null ? "" : (ViewData[ViewData["ActionGuidName"].ToString()] ?? ""))';
</script>

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        @*<h2>@ViewBag.Title</h2>*@
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Index", "Home")">主页</a>
            </li>
            <li>
                <a href="#">空运出口</a>
            </li>
            <li class="active">
                <strong>@ViewBag.Title</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>接单信息</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <form id="searchform" method="post" style="padding-bottom:10px; width:auto">
                        <div id="div_search" style="padding-top:5px; padding-bottom:3px; width:auto;" class="easyui-panel" title="查询条件"
                             data-options="collapsible:true">
                            <div class="form-group col-md-4">
                                <input id="CodeQuery" name="CodeQuery" tabindex="@(Num++)" data-options="prompt1:'编号'" style="width:20%" class="easyui-combogrid" type="text" />
                                <input id="Operation_Id" name="Operation_Id" tabindex="@(Num++)" data-options="prompt1:''" style="width:79%" class="easyui-textbox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">总单号:</label>
                                <input id="MBL" name="MBL" tabindex="@(Num++)" data-options="prompt1:'总单号'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">拼箱码:</label>
                                <input id="Lot_No" name="Lot_No" tabindex="@(Num++)" data-options="prompt1:'拼箱码'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">委托方:</label>
                                <input id="Entrustment_Code" name="Entrustment_Code" tabindex="@(Num++)" data-options="prompt1:'委托方'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">订舱方:</label>
                                <input id="Book_Flat_Code" name="Book_Flat_Code" tabindex="@(Num++)" data-options="prompt1:'订舱方'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">批次号:</label>
                                <input id="Batch_Num" name="Batch_Num" tabindex="@(Num++)" data-options="prompt1:'批次号'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>


                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">起运港:</label>
                                <input id="Depart_Port" name="Depart_Port" tabindex="@(Num++)" data-options="prompt1:'起运港'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">航班日期:</label>
                                <input id="_Flight_Date_Want" name="_Flight_Date_Want" tabindex="@(Num++)" data-options="prompt1:'航班日期'" style="width:79%" class="easyui-datebox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">至:</label>
                                <input id="Flight_Date_Want_" name="Flight_Date_Want_" tabindex="@(Num++)" data-options="prompt1:'至'" style="width:79%" class="easyui-datebox" type="text" />
                            </div>

                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">目的港:</label>
                                <input id="End_Port" name="End_Port" tabindex="@(Num++)" data-options="prompt1:'目的港'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">操作人:</label>
                                <input id="ADDID" name="ADDID" tabindex="@(Num++)" data-options="prompt1:'操作人'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">航班号:</label>
                                <input id="Flight_No" name="Flight_No" tabindex="@(Num++)" data-options="prompt1:'航班号'" style="width:79%" class="easyui-textbox" type="text" />
                            </div>

                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">Is_BAS:</label>
                                <input id="Is_BAS" name="Is_BAS" tabindex="@(Num++)" data-options="prompt1:'Is_BAS'" style="width:79%" class="easyui-combogrid" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">代操作:</label>
                                <input id="Is_DCZ" name="Is_DCZ" tabindex="@(Num++)" data-options="prompt1:'代操作'" style="width:79%" class="easyui-combogrid" type="text" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">重板:</label>
                                <input id="Is_ZB" name="Is_ZB" tabindex="@(Num++)" data-options="prompt1:'重板'" style="width:79%" class="easyui-combogrid" type="text" />
                            </div>

                            <div class="form-group col-md-4">
                                <label for="name" style="width:20%">退关:</label>
                                <input id="Is_TG" name="Is_TG" tabindex="@(Num++)" data-options="prompt1:'退关'" style="width:79%" class="easyui-combogrid" type="text" />
                            </div>
                            <div class="form-group col-md-8">
                                <input id="HWD" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />货未齐
                                <input id="HDQ" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />货到齐
                                <input id="WBG" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />未报关
                                <input id="YBG" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />已报关
                                <input id="WDZD" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />未打主单
                                <input id="ZDWC" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />主单完成
                                <input id="WSFD" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />未输分单
                                <input id="FDWC" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />分单完成
                                <input id="WZBQ" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />未制标签
                                <input id="YZBQ" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />已制标签
                                <input id="WCK" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />未出库
                                <input id="YCK" name="ADDWHOQuery" tabindex="@(Num++)" class="easyui-checkbox" type="checkbox" />已出库
                            </div>

                            <div class="form-group col-md-12">
                                <hr />
                            </div>
                            <div class="form-group col-md-4">
                            </div>
                            <div class="form-group col-md-4">
                                <button id="btn-search" class="btn btn-primary">
                                    @*<i class="fa fa-search"></i>*@
                                    搜索
                                </button>
                                <button id="btn-reset" class="btn btn-default">
                                    <i class="fa fa-reset"></i>
                                    重置
                                </button>
                            </div>

                            <div class="form-group col-md-4">
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive">
                        <table id="ops_entrustmentinfor_datagrid" class="easyui-datagrid" title="" style="width:auto;height:auto"
                               data-options="
							rownumbers:true,
							checkOnSelect:true,
							selectOnCheck:true,
							idField:'Id',
							sortName:'Id',
							sortOrder:'desc',
							remoteFilter: true,
							singleSelect: false,
							toolbar: '#ops_entrustmentinfor_toolbar',
							method: 'get',
							onClickCell: onClickCell,
                            onDblClickRow:onDblClickRow,
							onSelect:onSelect,
							pagination: 'true',
                            onLoadSuccess:totalCount,
                            onBeginEdit:onBeginEdit">
                            <thead>
                                <tr>
                                    <th data-options="field:'ck',checkbox:true"></th>
                                    @*<th data-options="field:'Id',width:80 ,sortable:true,resizable:true ">@Html.DisplayNameFor(model => model.Id)</th>*@
                                    <th data-options="field:'Batch_Num',width:120,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.Batch_Num)</th>
                                <th data-options="field:'Operation_Id',width:130,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.Operation_Id)</th>
                                <th data-options="field:'Entrustment_Name',width:140,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,100]'
										}
								}">@Html.DisplayNameFor(model => model.Entrustment_Name)</th>
                                <th data-options="field:'Lot_No',width:100,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.Lot_No)</th>
                                <th data-options="field:'MBL',width:100,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,20]'
										}
								}">@Html.DisplayNameFor(model => model.MBL)</th>
                                <th data-options="field:'HBL',width:100,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,20]'
										}
								}">@Html.DisplayNameFor(model => model.HBL)</th>
                                <th data-options="field:'FLIGHT_No',width:120,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,20]'
										}
								}">@Html.DisplayNameFor(model => model.Flight_No)</th>
                                <th data-options="field:'Flight_Date_Want',width:160,align:'right',sortable:true,resizable:true,
									formatter:datetimeformatter,
									editor:{
										type:'datetimebox',
										options:{
											required:false
										}
								}">@Html.DisplayNameFor(model => model.Flight_Date_Want)</th>
                                <th data-options="field:'Book_Flat_Code',width:120,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,20]'
										}
								}">@Html.DisplayNameFor(model => model.Book_Flat_Code)</th>
                                <th data-options="field:'Airways_Code',width:120,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,20]'
										}
								}">@Html.DisplayNameFor(model => model.Airways_Code)</th>
                                <th data-options="field:'Depart_Port',width:120,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.Depart_Port)</th>
                                @*<th data-options="field:'Transfer_Port',width:140,sortable:true,resizable:true,
                    editor:{
                        type:'textbox',
                        options:{
                            required:false ,validType:'length[0,50]'
                        }
                }">@Html.DisplayNameFor(model => model.Transfer_Port)</th>*@
                                <th data-options="field:'End_Port',width:120,sortable:true,resizable:true,
									editor:{
										type:'textbox',
										options:{
											required:false ,validType:'length[0,50]'
										}
								}">@Html.DisplayNameFor(model => model.End_Port)</th>

                                <th data-options="field:'Status',width:80,sortable:true,resizable:true,
                            editor:{
                                type:'textbox',
                                options:{
                                    required:false
                                }
                        }">@Html.DisplayNameFor(model => model.Status)</th>


                        @*<th data-options="field:'Consign_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.Consign_Code)</th>
        <th data-options="field:'Custom_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.Custom_Code)</th>
        <th data-options="field:'Area_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.Area_Code)</th>
        <th data-options="field:'Entrustment_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.Entrustment_Code)</th>
        <th data-options="field:'FWD_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.FWD_Code)</th>
        <th data-options="field:'Consignee_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.Consignee_Code)</th>
        <th data-options="field:'Carriage_Account_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.Carriage_Account_Code)</th>
        <th data-options="field:'Incidental_Account_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.Incidental_Account_Code)</th>
        <th data-options="field:'Shipper_H',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,200]'
                }
        }">@Html.DisplayNameFor(model => model.Shipper_H)</th>
        <th data-options="field:'Consignee_H',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,200]'
                }
        }">@Html.DisplayNameFor(model => model.Consignee_H)</th>
        <th data-options="field:'Notify_Part_H',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,200]'
                }
        }">@Html.DisplayNameFor(model => model.Notify_Part_H)</th>
        <th data-options="field:'Shipper_M',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,200]'
                }
        }">@Html.DisplayNameFor(model => model.Shipper_M)</th>
        <th data-options="field:'Consignee_M',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,200]'
                }
        }">@Html.DisplayNameFor(model => model.Consignee_M)</th>
        <th data-options="field:'Notify_Part_M',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,200]'
                }
        }">@Html.DisplayNameFor(model => model.Notify_Part_M)</th>
        <th data-options="field:'Pieces_TS',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Pieces_TS)</th>
        <th data-options="field:'Weight_TS',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Weight_TS)</th>
        <th data-options="field:'Pieces_SK',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Pieces_SK)</th>
        <th data-options="field:'Slac_SK',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Slac_SK)</th>
        <th data-options="field:'Weight_SK',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Weight_SK)</th>
        <th data-options="field:'Pieces_DC',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Pieces_DC)</th>
        <th data-options="field:'Slac_DC',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Slac_DC)</th>
        <th data-options="field:'Weight_DC',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Weight_DC)</th>
        <th data-options="field:'Pieces_Fact',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Pieces_Fact)</th>
        <th data-options="field:'Weight_Fact',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Weight_Fact)</th>
        <th data-options="field:'IS_MoorLevel',width:120,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.IS_MoorLevel)</th>
        <th data-options="field:'MoorLevel',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,20]'
                }
        }">@Html.DisplayNameFor(model => model.MoorLevel)</th>
        <th data-options="field:'Volume_TS',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Volume_TS)</th>
        <th data-options="field:'Charge_Weight_TS',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Charge_Weight_TS)</th>
        <th data-options="field:'Bulk_Weight_TS',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Bulk_Weight_TS)</th>
        <th data-options="field:'Volume_SK',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Volume_SK)</th>
        <th data-options="field:'Charge_Weight_SK',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Charge_Weight_SK)</th>
        <th data-options="field:'Bulk_Weight_SK',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Bulk_Weight_SK)</th>
        <th data-options="field:'Bulk_Percent_SK',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Bulk_Percent_SK)</th>
        <th data-options="field:'Account_Weight_SK',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Account_Weight_SK)</th>
        <th data-options="field:'Volume_DC',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Volume_DC)</th>
        <th data-options="field:'Charge_Weight_DC',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Charge_Weight_DC)</th>
        <th data-options="field:'Bulk_Weight_DC',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Bulk_Weight_DC)</th>
        <th data-options="field:'Bulk_Percent_DC',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Bulk_Percent_DC)</th>
        <th data-options="field:'Account_Weight_DC',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Account_Weight_DC)</th>
        <th data-options="field:'Volume_Fact',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Volume_Fact)</th>
        <th data-options="field:'Charge_Weight_Fact',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Charge_Weight_Fact)</th>
        <th data-options="field:'Bulk_Weight_Fact',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Bulk_Weight_Fact)</th>
        <th data-options="field:'Bulk_Percent_Fact',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Bulk_Percent_Fact)</th>
        <th data-options="field:'Account_Weight_Fact',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.Account_Weight_Fact)</th>
        <th data-options="field:'Marks_H',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,1000]'
                }
        }">@Html.DisplayNameFor(model => model.Marks_H)</th>
        <th data-options="field:'EN_Name_H',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,500]'
                }
        }">@Html.DisplayNameFor(model => model.EN_Name_H)</th>
        <th data-options="field:'Book_Remark',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,500]'
                }
        }">@Html.DisplayNameFor(model => model.Book_Remark)</th>
        <th data-options="field:'Delivery_Point',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,20]'
                }
        }">@Html.DisplayNameFor(model => model.Delivery_Point)</th>
        <th data-options="field:'Warehouse_Code',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,20]'
                }
        }">@Html.DisplayNameFor(model => model.Warehouse_Code)</th>
        <th data-options="field:'RK_Date',width:160,align:'right',sortable:true,resizable:true,
            formatter:datetimeformatter,
            editor:{
                type:'datetimebox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.RK_Date)</th>
        <th data-options="field:'CK_Date',width:160,align:'right',sortable:true,resizable:true,
            formatter:datetimeformatter,
            editor:{
                type:'datetimebox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.CK_Date)</th>
        <th data-options="field:'CH_Name',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,500]'
                }
        }">@Html.DisplayNameFor(model => model.CH_Name)</th>
        <th data-options="field:'AMS',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.AMS)</th>
        <th data-options="field:'Remark',width:140,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,500]'
                }
        }">@Html.DisplayNameFor(model => model.Remark)</th>
        <th data-options="field:'OperatingPoint',width:100,align:'right',sortable:true,resizable:true,
            editor:{
                type:'numberbox',
                options:{
                    required:true ,precision:0
                }
        }">@Html.DisplayNameFor(model => model.OperatingPoint)</th>*@

                        @*<th data-options="field:'ADDID',width:120,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.ADDID)</th>*@
                        @*<th data-options="field:'ADDWHO',width:120,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.ADDWHO)</th>*@
                        @*<th data-options="field:'ADDTS',width:160,align:'right',sortable:true,resizable:true,
            formatter:datetimeformatter,
            editor:{
                type:'datetimebox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.ADDTS)</th>*@
                        @*<th data-options="field:'EDITWHO',width:120,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.EDITWHO)</th>*@
                        @*<th data-options="field:'EDITTS',width:160,align:'right',sortable:true,resizable:true,
            formatter:datetimeformatter,
            editor:{
                type:'datetimebox',
                options:{
                    required:false
                }
        }">@Html.DisplayNameFor(model => model.EDITTS)</th>*@
                        @*<th data-options="field:'EDITID',width:120,sortable:true,resizable:true,
            editor:{
                type:'textbox',
                options:{
                    required:false ,validType:'length[0,50]'
                }
        }">@Html.DisplayNameFor(model => model.EDITID)</th>*@
                    </tr>
                    </thead>
                    </table>
                        <div id="ops_entrustmentinfor_toolbar" style="height:auto">
                            <label id="totalCount" onclick="totalCount()"></label>
                            @*@if (Html.IsAuthorize("Create"))
                                {
                                    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-plus',plain:true" onclick="append()">新增</a>
                                }
                                @if (Html.IsAuthorize("Delete"))
                                {
                                    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" onclick="removeit()">删除</a>
                                }
                                @if (Html.IsAuthorize("Edit"))
                                {
                                    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true" onclick="accept()">保存</a>
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-refresh',plain:true" onclick="reload()">刷新</a>
                                }
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-undo',plain:true" onclick="reject()">取消</a>
                                @if (Html.IsAuthorize("Import"))
                                {
                                    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-paperclip',plain:true" onclick="importexcel()">EXCEL 导入</a>
                                    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-download-alt',plain:true" onclick="exportexcel()">导出 Excel</a>
                                }
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-plus',plain:true" onclick="append()">新增</a>
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" onclick="removeit()">删除</a>
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true" onclick="accept()">保存</a>
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-undo',plain:true" onclick="reject()">取消</a>
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-paperclip',plain:true" onclick="importexcel()">EXCEL 导入</a>
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-download-alt',plain:true" onclick="exportexcel()">导出 Excel</a>
                                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-refresh',plain:true" onclick="reload()">刷新</a>*@
                        </div>
                        <div align="center">
                            @*<input type="button" accesskey="n" onclick="append()" value="新增业务(N)">*@
                            <input type="button" accesskey="n" onclick="append1()" value="新增业务(N)">
                            <input type="button" accesskey="c" onclick="copyappend()" value="复制业务(C)">
                            <input type="button" accesskey="v" value="仓库信息(V)">
                            <input type="button" value="进仓信息">
                            <input type="button" accesskey="f" onclick="ToCusIndex()" value=" 报关报检(f)">
                            <input type="button" accesskey="k" onclick="ToDocMent()"value="单证管理(K)">
                            <input type="button" accesskey="y" value="异常登记(Y)">
                            <input type="button" accesskey="p" value="打  印(P)">
                            <input type="button" accesskey="d" onclick="exportexcel()" value="导  出(D)">
                            <input type="button" accesskey="a" value="结算信息(A)">
                            <input type="button" value="仓库接单">
                            <input type="button" onclick="openbatch_num()" value="生成批次号"><br>
                            <input type="button" accesskey="t" value="退单登记(T)">
                            <input type="button" accesskey="h" value="签收单打印(H)">
                            <input type="button" value="退客户登记">
                            <input type="button" accesskey="g" value="退单情况(G)">
                            <input type="button" accesskey="b" value="批量修改(B)">
                            <input type="button" accesskey="l" value="综合查询(L)">
                            <input type="button" onclick="savetg(true)" value="退  关">
                            <input type="button" onclick="savetg(false)" value="取消退关">
                            @*<input type="button" onclick="createlot_no()" value="生成拼箱码">*@
                        </div>
                    </div>
                    <div class="form-group col-md-12" id="div_Batch_Num">
                        <div id="div_Batch_Num_panel" style="padding-top:20px; padding-bottom:10px;width:100%" class="easyui-panel" title="生成批次号"
                             data-options="collapsible:true">
                            <div class="form-group col-md-3"></div>
                            <div class="form-group col-md-6" id="Creat_Batch_Num">
                                <label style="width:20%">请输入批次号：</label>
                                <input type="text" class="easyui-textbox" id="addBatch_Num" style="width:60%" />
                                <button onclick="addbatch_num()">保存</button>
                            </div>
                            <div class="form-group col-md-3"></div>
                        </div>
                    </div>
                    <!-- end ibox-content -->
                </div>
            </div>
        </div>
    </div>
</div>
<div id="importwindow" class="easyui-window" title="Excel 导入" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,closed:true,iconCls:'icon-paperclip'" style="width:500px;height:260px;padding:10px;">
    <p><input type="file" name="file_upload" id="file_upload" /></p>
</div>

@section Scripts {
    <script type="text/javascript">
        $(function () {
            initPage();
            $("#div_Batch_Num").hide();
            searchf();
            $("#file_upload").uploadifive({
                'height': 30,
                'fileTypeDesc': 'Excel 2010 Files',
                'fileTypeExts': '*.xlsx',
                'uploadScript': '/FileUpload/Upload',
                'buttonText': '选择EXCEL',
                'multi': true,
                'displayData': 'speed',
                'formData': { 'modelType': 'OPS_EntrustmentInfor' },
                'width': 120,
                'successTimeout': 100000,
                'onFallback': function () {
                    $.messager.alert('导入错误', '导入错误，请重试！<br>', 'error');
                    $('#file_upload').uploadifive('clearQueue')
                },
                'onSelect': function (queue) {
                    $.messager.progress({
                        title: '执行导入',
                        msg: '请等待...'
                    });
                },
                'onUploadComplete': function (file, data) {
                    $.messager.progress('close');
                    var data = $.parseJSON(data);
                    //console.log(data);
                    if (data.success == false) {
                        $.messager.alert('导入错误', '导入错误，请修改后再倒入！<br>' + data.message, 'error');
                        $("#file_upload").uploadifive('clearQueue')
                    } else {
                        $.messager.alert('导入完成', '导入完成！<br>', 'info');
                        //$dg.datagrid('reload');
                        $('#importwindow').window('close');
                    }
                    return true;
                    //alert('The file ' + file.name + ' was successfully uploaded with a response of ' + response + ':' + data);
                }
            });
        });

        var $dg = $('#ops_entrustmentinfor_datagrid');
        var editIndex = undefined;


        //初始化页面
        function initPage() {
            //设置Combogrid 分页控件 简单模式

            //Is_BAS
            $("#Is_BAS").combogrid({
                panelHeight: 'auto',
                mode: 'remote',
                idField: 'ID',
                valueField: 'ID',
                textField: 'TEXT',
                pageSize: 10,
                pageList: [5, 10, 20],
                pagination: true,
                columns: [[
                    //{ field: 'ID', title: '代码', width: 80 },
                    { field: 'TEXT', title: '名称', width: 80 }
                ]],
                data: [
                    { ID: "", TEXT: "" },
                    { ID: "false", TEXT: "否" },
                    { ID: "true", TEXT: "是" }
                ]
            });
            //代操作
            $("#Is_DCZ").combogrid({
                panelHeight: 'auto',
                mode: 'remote',
                idField: 'ID',
                valueField: 'ID',
                textField: 'TEXT',
                pageSize: 10,
                pageList: [5, 10, 20],
                pagination: true,
                columns: [[
                    //{ field: 'ID', title: '代码', width: 80 },
                    { field: 'TEXT', title: '名称', width: 80 }
                ]],
                data: [
                    { ID: "", TEXT: "" },
                    { ID: "false", TEXT: "否" },
                    { ID: "true", TEXT: "是" }
                ]
            });
            //重板
            $("#Is_ZB").combogrid({
                panelHeight: 'auto',
                mode: 'remote',
                idField: 'ID',
                valueField: 'ID',
                textField: 'TEXT',
                pageSize: 10,
                pageList: [5, 10, 20],
                pagination: true,
                columns: [[
                    //{ field: 'ID', title: '代码', width: 80 },
                    { field: 'TEXT', title: '名称', width: 80 }
                ]],
                data: [
                    { ID: "", TEXT: "" },
                    { ID: "false", TEXT: "否" },
                    { ID: "true", TEXT: "是" }
                ]
            });
            //退关
            $("#Is_TG").combogrid({
                panelHeight: 'auto',
                mode: 'remote',
                idField: 'ID',
                valueField: 'ID',
                textField: 'TEXT',
                pageSize: 10,
                pageList: [5, 10, 20],
                pagination: true,
                columns: [[
                    //{ field: 'ID', title: '代码', width: 80 },
                    { field: 'TEXT', title: '名称', width: 80 }
                ]],
                data: [
                    { ID: "", TEXT: "" },
                    { ID: "false", TEXT: "否" },
                    { ID: "true", TEXT: "是" }
                ]
            });

            //业务编号和批次号
            $("#CodeQuery").combogrid({
                panelHeight: 'auto',
                idField: 'ID',
                valueField: 'ID',
                textField: 'TEXT',
                value: "Operation_Id",
                data: [
                    { ID: 'Operation_Id', TEXT: '业务编号' },
		            { ID: 'CldOperation_Id', TEXT: '承揽点业务编号' },
		            { ID: 'Entrustment_Code', TEXT: '委托方编号' }
                ],
                columns: [[
                    { field: 'TEXT', title: '--请选择--', width: 130 }
                ]]
            });
        }
        //航班日期输入框点击事件
        $("#_Flight_Date_Want").datebox({
            'click': function () {
                var myDate = new Date();
                //获取当前年
                var year = myDate.getFullYear();
                console.log("year:", year);
                $("#_Flight_Date_Want").datebox("setValue", year);
            }
        });
        //查询条件重置按钮 点击事件
        $("#btn-reset").click(function (e) {
            e.preventDefault();
            clearfrom();
        });
        //点击重置按钮时，触发，清空查询条件
        function clearfrom() {
            $('#searchform').form('clear');
        }
        $("#btn-search").click(function (e) {
            e.preventDefault();
            searchf();
        });
        //点击查询按钮时，触发
        function searchf() {
            setfilteropts();//设置查询条件
            var opts = $('#ops_entrustmentinfor_datagrid').datagrid('options');
            opts.url = '/OPS_EntrustmentInfors/GetData';
            opts.pageNumber = 1;
            var pager = $('#ops_entrustmentinfor_datagrid').datagrid('getPager');
            pager.pagination('refresh', {
                pageNumber: 1
            });
            $('#ops_entrustmentinfor_datagrid').datagrid('reload');
            totalCount();
        }
        //设置查询条件
        function setfilteropts() {
            var Operation_Id = $("#Operation_Id").textbox("getValue");
            var MBL = $("#MBL").textbox("getValue");
            var Lot_No = $("#Lot_No").textbox("getValue");
            var Entrustment_Code = $("#Entrustment_Code").textbox("getValue");
            var Book_Flat_Code = $("#Book_Flat_Code").textbox("getValue");
            var Batch_Num = $("#Batch_Num").textbox("getValue");
            var Depart_Port = $("#Depart_Port").textbox("getValue");
            var _Flight_Date_Want = $("#_Flight_Date_Want").textbox("getValue");
            var Flight_Date_Want_ = $("#Flight_Date_Want_").textbox("getValue");
            var End_Port = $("#End_Port").textbox("getValue");
            var Flight_No = $("#Flight_No").textbox("getValue");
            var ADDID = $("#ADDID").textbox("getValue");
            var Is_BAS = $("#Is_BAS").combogrid("getValue");
            var Is_DCZ = $("#Is_DCZ").combogrid("getValue");
            var Is_ZB = $("#Is_ZB").combogrid("getValue");
            var Is_TG = $("#Is_TG").combogrid("getValue");


            var params = [];
            var opts = $('#ops_entrustmentinfor_datagrid').datagrid('options');

            if ($("#CodeQuery").textbox("getValue") == "Operation_Id") {//业务编号
                if (!(typeof (Operation_Id) === 'undefined' || Operation_Id == null || Operation_Id == "")) {
                    params.push({ "field": "Operation_Id", "op": "equal", "value": Operation_Id });
                }
            } else if ($("#CodeQuery").textbox("getValue") == "CldOperation_Id") {//承揽点与我们编号

            } else if ($("#CodeQuery").textbox("getValue") == "Entrustment_Code") {//委托方编号
                if (!(typeof (Operation_Id) === 'undefined' || Operation_Id == null || Operation_Id == "")) {
                    params.push({ "field": "Entrustment_Code", "op": "equal", "value": Operation_Id });
                }
            }
            if (!(typeof (MBL) === 'undefined' || MBL == null || MBL == "")) {
                params.push({ "field": "MBL", "op": "equal", "value": MBL });
            }
            if (!(typeof (Lot_No) === 'undefined' || Lot_No == null || Lot_No == "")) {
                params.push({ "field": "Lot_No", "op": "equal", "value": Lot_No });
            }
            if (!(typeof (Entrustment_Code) === 'undefined' || Entrustment_Code == null || Entrustment_Code == "")) {
                params.push({ "field": "Entrustment_Code", "op": "equal", "value": Entrustment_Code });
            }
            if (!(typeof (Book_Flat_Code) === 'undefined' || Book_Flat_Code == null || Book_Flat_Code == "")) {
                params.push({ "field": "Book_Flat_Code", "op": "equal", "value": Book_Flat_Code });
            }
            if (!(typeof (Batch_Num) === 'undefined' || Batch_Num == null || Batch_Num == "")) {
                params.push({ "field": "Batch_Num", "op": "equal", "value": Batch_Num });
            }
            if (!(typeof (Depart_Port) === 'undefined' || Depart_Port == null || Depart_Port == "")) {
                params.push({ "field": "Depart_Port", "op": "equal", "value": Depart_Port });
            }
            if (!(typeof (_Flight_Date_Want) === 'undefined' || _Flight_Date_Want == null || _Flight_Date_Want == "")) {
                params.push({ "field": "_Flight_Date_Want", "op": "equal", "value": _Flight_Date_Want });
            }
            if (!(typeof (Flight_Date_Want_) === 'undefined' || Flight_Date_Want_ == null || Flight_Date_Want_ == "")) {
                params.push({ "field": "Flight_Date_Want_", "op": "equal", "value": Flight_Date_Want_ });
            }
            if (!(typeof (End_Port) === 'undefined' || End_Port == null || End_Port == "")) {
                params.push({ "field": "End_Port", "op": "equal", "value": End_Port });
            }
            if (!(typeof (Flight_No) === 'undefined' || Flight_No == null || Flight_No == "")) {
                params.push({ "field": "Flight_No", "op": "equal", "value": Flight_No });
            }
            if (!(typeof (ADDID) === 'undefined' || ADDID == null || ADDID == "")) {
                params.push({ "field": "ADDID", "op": "equal", "value": ADDID });
            }
            if (!(typeof (Is_BAS) === 'undefined' || Is_BAS == null || Is_BAS == "")) {
                params.push({ "field": "Is_BAS", "op": "equal", "value": Is_BAS });
            }
            if (!(typeof (Is_DCZ) === 'undefined' || Is_DCZ == null || Is_DCZ == "")) {
                params.push({ "field": "Is_DCZ", "op": "equal", "value": Is_DCZ });
            }
            if (!(typeof (Is_ZB) === 'undefined' || Is_ZB == null || Is_ZB == "")) {
                params.push({ "field": "Is_ZB", "op": "equal", "value": Is_ZB });
            }
            if (!(typeof (Is_TG) === 'undefined' || Is_TG == null || Is_TG == "")) {
                params.push({ "field": "Is_TG", "op": "equal", "value": Is_TG });
            }
            opts.queryParams = {
                'filterRules': JSON.stringify(params)
            };

        }


        function totalCount() {
            var data = $dg.datagrid("getRows");
            var Pieces = 0;//件数
            var Weight = 0;//重量
            var Volume = 0;//体积
            var total = 0;//件数总和
            if (data != null) {
                total = data.length;
                $.each(data, function (index, item) {
                    //件数=托书/件数+收款分单/件数+订舱主单/件数+进仓实际/件数
                    Pieces += item.Pieces_TS + item.Pieces_SK + item.Pieces_DC + item.Pieces_Fact;
                    //重量=托书/毛重+收款分单/毛重+订舱主单/毛重+进仓实际/毛重
                    Weight += item.Weight_TS + item.Weight_SK + item.Weight_DC + item.Weight_Fact;
                    //体积=托书/体积+收款分单/体积+订舱主单/体积+进仓实际/体积
                    Volume += item.Volume_TS + item.Volume_SK + item.Volume_DC + item.Volume_Fact;
                });
            }
            $("#totalCount").text("共 " + total + " 票|件数：" + Pieces + " |重量： " + Weight + " |体积:" + Volume);
        }

        function importexcel() {
            $('#importwindow').window('open');
        }

        function exportexcel() {
            setfilteropts();//设置查询条件
            var opts = $dg.datagrid('options');
            //var filterRules = JSON.stringify(opts.filterRules);
            //$.messager.progress({ title: '正在执行导出！' });
            //var formData = new FormData();
            //formData.append('filterRules', filterRules);
            //formData.append('sort', 'Id');
            //formData.append('order', 'asc');
            //$.postDownload('/OPS_EntrustmentInfors/ExportExcel', formData, function (fileName) {
            //	$.messager.progress('close');
            //});

            var formData = { filterRules: opts.filterRules, sort: opts.sortName, order: opts.sortOrder };
            var url = '/OPS_EntrustmentInfors/ExportExcel';
            $.DownLoadProgress({
                url: url,         //下载文件的url
                method: 'Post',   //链接打开方式
                data: formData,         //要发送的数据
                downLoadInfo: '下载文件', //下载界面文字
                closeDelay: 2000, //自动关闭时间(毫秒) 0则立马关闭
                callbackFuc: function () {
                    $.messager.progress('close');
                }
            });
        }

        function reload() {
            reject();//回滚所有变更
            $dg.datagrid('reload');
        }

        //combogrid 设置信息（onBeginEdit时,使用）
        var combogrid_Settings = {
            'COUNTRY': {
                required: true,
                url: '/PARA_COUNTRYS/GetPagerPARA_COUNTRY',
                method: 'get',
                delay: 500,
                multiple: false,
                panelHeight: 'auto',
                panelWidth: 205,
                idField: 'COUNTRY_CO',
                valueField: 'COUNTRY_CO',
                textField: 'COUNTRY_NA',
                pageSize: 10,//每页显示的记录条数，默认为10
                pageList: [5, 10, 20],//可以设置每页记录条数的列表
                pagination: true,//是否分页
                columns: [[
					{ field: 'COUNTRY_CO', title: '代码', width: 53 },
                    { field: 'COUNTRY_NA', title: '名称', width: 150 }
                ]],
                onLoadSuccess: function () {
                    ondgLoadSuccess($dg, 'COUNTRY', rowIndex);
                },
                onChange: function (value) {
                    var targetEditor = $dg.datagrid('getEditor', {
                        field: 'COUNTRY',
                        index: editIndex
                    });
                    if (targetEditor != null) {
                        var Selted = $(targetEditor.target).combogrid('grid').datagrid('getSelected');
                        if (Selted) {
                            var datarow = $dg.datagrid('getData').rows[editIndex];
                            if (!(typeof datarow === 'undefined' || datarow == null)) {
                                datarow['COUNTRY' + 'NAME'] = Selted[$(targetEditor.target).combogrid('options').textField];
                            }
                        }
                    }
                },
                keyHandler: {
                    up: function (e) {
                        combogrid_upKey(this, e);
                    },
                    down: function (e) {
                        combogrid_downKey(this, e);
                    },
                    enter: function (e) {
                        combogrid_enterKey(this, e, $dg, 'COUNTRY', rowIndex);
                    },
                    query: function (q) {
                        combogrid_query(this, q, rowIndex, {});
                    }
                }
            }
        };

        //开始编辑行时，赋值 联动数据
        function onBeginEdit(rowIndex, rowData) {
            var num = 0;
            var regx = /^\/Date\([0-9]+(\)\/)$/g;
            for (var i in rowData) {
                if (regx.test(rowData[i])) {
                    rowData[i] = datetimeformatter(rowData[i]);
                }
                var targetEditor = $dg.datagrid('getEditor', {
                    field: i,
                    index: rowIndex
                });
                //console.log("targetEditor", i, targetEditor);
                if (targetEditor) {
                    num++;
                    if (num == 1 && $(targetEditor.target).val() == '') {
                        $(targetEditor.target).parent().children("span:eq(0)").children("input:eq(0)").focus();
                    }

                    var OldVal = targetEditor.oldHtml;
                    switch (targetEditor.type.toLowerCase()) {
                        case "combogrid":
                            //console.log(targetEditor);
                            var combogrid_Setting = combogrid_Settings[targetEditor.field];
                            if (combogrid_Setting) {
                                $(targetEditor.target).combogrid(combogrid_Setting);
                            }
                            if (!(typeof (OldVal) === 'undefined' || OldVal == null || OldVal == '')) {
                                if (rowData[targetEditor.field]) {
                                    OldVal = rowData[targetEditor.field];
                                }
                                $(targetEditor.target).combogrid('setValue', OldVal);
                                var opts = $(targetEditor.target).combogrid('options');
                                var url = opts.url;
                                //设置查询参数
                                var queryParams = {
                                    page: 1,
                                    rows: opts.pageSize,
                                    q: OldVal
                                };
                                $(targetEditor.target).combogrid('grid').datagrid('load', queryParams);
                            }
                            break;
                        case "combobox":
                            var opts = $(targetEditor.target).combobox({
                                inputEvents: $.extend({}, $.fn.combobox.defaults.inputEvents, {
                                    keydown: function (event) {
                                        combobox_keydown(this, event, $dg, rowIndex);
                                    }
                                })
                            });
                            setTargetVal(targetEditor, OldVal);
                            break;
                        case "textbox":
                            $(targetEditor.target).textbox({
                                inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                    keydown: function (event) {
                                        Listtextbox_keydown(this, event, $dg, rowIndex);
                                    }
                                })
                            });
                            break;
                        case "numberbox":
                            $(targetEditor.target).numberbox({
                                inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                    keydown: function (event) {
                                        Listtextbox_keydown(this, event, $dg, rowIndex);
                                    }
                                })
                            });
                            break;
                        case "datebox":
                            $(targetEditor.target).datebox({
                                inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                    keydown: function (event) {
                                        Listtextbox_keydown(this, event, $dg, rowIndex);
                                    }
                                })
                            });
                            setTargetVal(targetEditor, OldVal);
                            break;
                        case "datetimebox":
                            $(targetEditor.target).datetimebox({
                                inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
                                    keydown: function (event) {
                                        Listtextbox_keydown(this, event, $dg, rowIndex);
                                    }
                                })
                            });
                            setTargetVal(targetEditor, OldVal);
                            break;
                        case "checkbox":
                            $(targetEditor.target).keydown(function (e) {
                                chk_rdo_keydown(this, e, $dg, rowIndex);
                            });
                            setTargetVal(targetEditor, OldVal);
                            break;
                        case "radio":
                            $(targetEditor.target).keydown(function (e) {
                                chk_rdo_keydown(this, e, $dg, rowIndex);
                            });
                            setTargetVal(targetEditor, OldVal);
                            break;
                    }
                }
            }
        }

        function endEditing() {
            if (editIndex == undefined)
                return true;
            if ($dg.datagrid('validateRow', editIndex)) {
                $dg.datagrid('endEdit', editIndex);
                editIndex = undefined;
                return true;
            } else {
                return false;
            }
        }

        //双击当前行，打开编辑窗口
        function onDblClickRow(index, row) {
            $(location).attr('href', "/OPS_EntrustmentInfors/OPS_Edit?id=" + row.Id);
        }
        function onClickCell(index, field) {
            var _operates = ["_operate1", "_operate2", "_operate3", "ck"]
            if ($.inArray(field, _operates) >= 0) {
                return;
            }
            if (editIndex != index) {
                if (endEditing()) {
                    @if (!Html.IsAuthorize("OPS_EntrustmentInfors", "Index", "Edit"))
                    {
                        @Html.Raw("$.messager.alert('提示', '您没有编辑权限！');");
                        @Html.Raw("return;\r\n");
                    }
                    //动态设置 编辑样式
                    var byteColumn = $dg.datagrid('getColumnOption', 'ADDWHO');
                    if (!(typeof (byteColumn) === 'undefined' || byteColumn == null || byteColumn == '')) {
                        byteColumn.editor = {};
                        byteColumn = $dg.datagrid('getColumnOption', 'ADDTS');
                        byteColumn.editor = {};
                        var byteColumn = $dg.datagrid('getColumnOption', 'EDITWHO');
                        byteColumn.editor = {
                            type: 'textbox',
                            options: {
                                required: false,
                                validType: 'length[0,20]'
                            }
                        };
                        byteColumn = $dg.datagrid('getColumnOption', 'EDITTS');
                        byteColumn.editor = {
                            type: 'datebox',
                            options: {
                                required: false
                            }
                        };
                    }

                    //$dg.datagrid('selectRow', index).datagrid('beginEdit', index);
                    var ed = $dg.datagrid('getEditor', { index: index, field: field });
                    if (ed) {
                        ($(ed.target).data('textbox') ? $(ed.target).textbox('textbox') : $(ed.target)).focus();
                    }
                    editIndex = index;
                } else {
                    $dg.datagrid('selectRow', editIndex);
                }
            }
        }

        //加载成功
        function onLoadSuccess(rowdata) {
            //行号自适应宽度
            $(this).datagrid("fixRownumber");
        }
        //承揽接单 新增-主单
        function append1() {
            $(location).attr("href", "/OPS_EntrustmentInfors/OPS_Create_M");
        }
        //承揽接单 新增
        function append() {
            $(location).attr("href", "/OPS_EntrustmentInfors/OPS_Create");
        }
        //承揽接单 复制新增
        function copyappend() {
            var row = $dg.datagrid("getSelections");
            if (row.length > 1) {
                $.messager.alert("提示", "复制新增功能，只能选中一行数据！"); return;
            }
            if (row.length == 0) {
                $.messager.alert("提示", "复制新增功能，必须选中一行数据！"); return;
            }
            $(location).attr('href', "/OPS_EntrustmentInfors/OPS_Create?id=" + row[0].Id);
        }

        function removeit() {
            var Seltdata = $dg.datagrid('getSelections');
            if (!(typeof editIndex === 'undefined' || editIndex == null || isNaN(editIndex))) {
                $dg.datagrid('cancelEdit', editIndex);
                editIndex = undefined;
            }
            for (var i = Seltdata.length; i > 0; i--) {
                var rowindex = $dg.datagrid('getRowIndex', Seltdata[i - 1]);
                //console.log(rowindex);
                $dg.datagrid('deleteRow', rowindex);
            }
        }

        function accept() {
            if (endEditing()) {
                if ($dg.datagrid('getChanges').length) {
                    var inserted = $dg.datagrid('getChanges', "inserted");
                    var deleted = $dg.datagrid('getChanges', "deleted");
                    var updated = $dg.datagrid('getChanges', "updated");
                    var effectRow = new Object();
                    if (inserted.length) {
                        effectRow.inserted = inserted;
                    }
                    if (deleted.length) {
                        effectRow.deleted = deleted;
                    }
                    if (updated.length) {
                        effectRow.updated = updated;
                    }
                    //console.log(JSON.stringify(effectRow));
                    var url = '/OPS_EntrustmentInfors/SaveData';
                    $.ajax({
                        type: 'POST',
                        url: url,//获取数据的函数
                        async: true,//true 异步，false 同步
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify(effectRow),//查询条件JSON.stringify()
                        beforeSend: function (xhr) {//发送请求前运行的函数
                            $.messager.progress({
                                title: '数据处理中',
                                msg: '数据处理中，请等待...'
                            });
                            //验证重复提交时 请加上 这句
                            AddAjaxActionGuidName(this);
                        },
                        success: function (response) {//查询成功,data为返回的数据
                            if (response.Success) {
                                $.messager.alert("提示", "提交成功！");
                                $dg.datagrid('acceptChanges');
                                //$dg.datagrid('reload');
                            }
                            else {
                                var ErrMsgStr = '提交错误了！';
                                if (!(typeof (response.ErrMsg) === 'undefined' || response.ErrMsg == null || response.ErrMsg == ''))
                                    ErrMsgStr = response.ErrMsg;
                                $.messager.alert("错误", ErrMsgStr, 'error');
                            }
                        },
                        error: function () {//查询失败
                            $.messager.alert("错误", "提交错误了！", 'error');
                        },
                        complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
                            $.messager.progress('close');
                        }
                    });
                }
                //$dg.datagrid('acceptChanges');
            }
        }

        function reject() {
            $dg.datagrid('rejectChanges');
            editIndex = undefined;
        }

        function getChanges() {
            var rows = $dg.datagrid('getChanges');
            alert(rows.length + ' rows are changed!');
        }

        //自动添加 textbox 或 text的值
        function AutoAddFilterRule($dg_) {
            var ColumnsFields = $dg_.datagrid('getColumnFields');
            $.each(ColumnsFields, function (i, ColumnName) {
                var input = $dg_.datagrid('getFilterComponent', ColumnName);
                if (!(input.data("datebox") || input.data("datetimebox") || input.data("combobox") || input.data("checkbox") || input.data("combotree") || input.data("combogrid") || input.data("numberbox"))) {
                    var rule = $dg_.datagrid('getFilterRule', ColumnName);
                    var value = input.val();
                    if (!(typeof (value) === 'undefined' || value == null || value == '')) {
                        if ((rule && rule.value != value) || !rule) {
                            $dg_.datagrid('addFilterRule', {
                                field: ColumnName,
                                op: 'equal',
                                value: value
                            });
                        }
                    } else {
                        if (rule) {
                            $dg_.datagrid('removeFilterRule', ColumnName);
                        }
                    }
                }
            });
        }
        //数组化Id号
        function getSelectDatagrid(rows) {
            var ids = [];
            for (var i = 0; i < rows.length; i++) {
                ids.push(rows[i].Id);
            }
            return ids;
        }
        //生成拼箱码
        function createlot_no() {
            var rows = $dg.datagrid('getSelections');
            console.log("row:", rows);
            if (rows.length == 0) {
                $.messager.alert("提示", "请选择需要生成拼箱码的接单信息！");
                return false;
            }
            $.messager.confirm('确认对话框', '您确认生成拼箱码！', function (r) {
                if (r) {
                    var ids = getSelectDatagrid(rows);
                    if (ids.length > 0) {
                        SaveBatchLot_No(ids);
                    } else {
                        $.messager.alert("提示", "选中的接单信息不符合生成拼箱码所需的状态！", "error");
                    }
                }
            });
        }


        //批量生成拼箱码
        function SaveBatchLot_No(ids) {
            var IDS = JSON.stringify(ids);
            var url = '/OPS_EntrustmentInfors/SaveLot_No?ids=' + ids;
            $.ajax({
                type: 'POST',
                url: url,//获取数据的函数
                async: true,//true 异步，false 同步
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {//发送请求前运行的函数
                    //console.log('beforeSend');
                    $.messager.progress({
                        title: '数据处理中',
                        msg: '数据处理中，请等待...'
                    });
                    AddAjaxActionGuidName(this);
                },
                success: function (data) {//查询成功,data为返回的数据
                    if (data.Success) {
                        $.messager.alert("提示", "提交成功！", "info");
                        $dg.datagrid('reload');
                        $dg.datagrid('clearSelections');
                    }
                    else {
                        var ErrMsgStr = '提交错误了！';
                        if (!(typeof (data.ErrMsg) === 'undefined' || data.ErrMsg == null || data.ErrMsg == ''))
                            ErrMsgStr = data.ErrMsg;
                        $.messager.alert("错误", ErrMsgStr, 'error');
                    }
                },
                error: function () {//查询失败
                    $.messager.alert("错误", "提交错误了！", 'error');
                },
                complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
                    $.messager.progress('close');
                }
            });
        }

        //显示生成批次号窗体
        function openbatch_num() {
            $("#div_Batch_Num").show();
        }
        //生成的批次号
        function addbatch_num() {
            var rows = $dg.datagrid('getSelections');
            if (rows.length == 0) {
                $.messager.alert("提示", "请选择需要生成批次号的接单信息！");
                return false;
            }
            $.messager.confirm('确认对话框', '您确认生成批次号！', function (r) {
                if (r) {
                    var ids = getSelectDatagrid(rows);
                    if (ids.length > 0) {
                        SaveBatch_Num(ids);
                    } else {
                        $.messager.alert("提示", "选中的接单信息不符合生成批次号所需的状态！", "error");
                    }
                }
            });
        }

        //保存批量生成拼箱码
        function SaveBatch_Num(ids) {
            var IDS = JSON.stringify(ids);
            var url = '/OPS_EntrustmentInfors/SaveBatch_Num?ids=' + ids + '&Batch_Num=' + $("#addBatch_Num").textbox("getValue");
            $.ajax({
                type: 'POST',
                url: url,//获取数据的函数
                async: true,//true 异步，false 同步
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {//发送请求前运行的函数
                    //console.log('beforeSend');
                    $.messager.progress({
                        title: '数据处理中',
                        msg: '数据处理中，请等待...'
                    });
                    AddAjaxActionGuidName(this);
                },
                success: function (data) {//查询成功,data为返回的数据
                    if (data.Success) {
                        $.messager.alert("提示", "提交成功！", "info");
                        $dg.datagrid('reload');
                        $dg.datagrid('clearSelections');
                        $("#div_Batch_Num").hide();
                    }
                    else {
                        var ErrMsgStr = '提交错误了！';
                        if (!(typeof (data.ErrMsg) === 'undefined' || data.ErrMsg == null || data.ErrMsg == ''))
                            ErrMsgStr = data.ErrMsg;
                        $.messager.alert("错误", ErrMsgStr, 'error');
                    }
                },
                error: function () {//查询失败
                    $.messager.alert("错误", "提交错误了！", 'error');
                },
                complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
                    $.messager.progress('close');
                }
            });
        }

        //退关或取消退关
        function savetg(value) {
            var rows = $dg.datagrid('getSelections');
            if (rows.length == 0) {
                $.messager.alert("提示", "请选择需要退关的接单信息！");
                return false;
            }
            $.messager.confirm('确认对话框', '您确认退关！', function (r) {
                if (r) {
                    var ids = getSelectDatagrid(rows);
                    if (ids.length > 0) {
                        SaveBatch_TG(ids, value);
                    } else {
                        $.messager.alert("提示", "选中的接单信息不符合退关所需的状态！", "error");
                    }
                }
            });
        }
        function SaveBatch_TG(ids,value) {
            var IDS = JSON.stringify(ids);
            var url = '/OPS_EntrustmentInfors/SaveBatch_TG?ids=' + ids + '&is_tg=' + value;
            $.ajax({
                type: 'POST',
                url: url,//获取数据的函数
                async: true,//true 异步，false 同步
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {//发送请求前运行的函数
                    //console.log('beforeSend');
                    $.messager.progress({
                        title: '数据处理中',
                        msg: '数据处理中，请等待...'
                    });
                    AddAjaxActionGuidName(this);
                },
                success: function (data) {//查询成功,data为返回的数据
                    if (data.Success) {
                        $.messager.alert("提示", "提交成功！", "info");
                        $dg.datagrid('reload');
                        $dg.datagrid('clearSelections');
                        $("#div_Batch_Num").hide();
                    }
                    else {
                        var ErrMsgStr = '提交错误了！';
                        if (!(typeof (data.ErrMsg) === 'undefined' || data.ErrMsg == null || data.ErrMsg == ''))
                            ErrMsgStr = data.ErrMsg;
                        $.messager.alert("错误", ErrMsgStr, 'error');
                    }
                },
                error: function () {//查询失败
                    $.messager.alert("错误", "提交错误了！", 'error');
                },
                complete: function (xhr, status) {//请求完成时运行的函数（在请求成功或失败之后均调用，即在 success 和 error 函数之后）。
                    $.messager.progress('close');
                }
            });
        }

        //-----------------------------------------------------
        //datagrid onSelect
        //-----------------------------------------------------
        function onSelect(index, row) {
            //console.log(index, row);
        }

        //自适应页面大小
        function MyNavResize() {
            var opts = $("#navbar-minimalize").NavResize('getOptions');
            opts.Auto = false;
            opts.OnNavResizefunc = function () {
                //$("#edit_div_one").css('width', "100%");
                //$("#edit_div_two").css('width', "100%");
                //$("#OrderInfo").datagrid("resize", { width: "100%" });
                //$("#OrderDetail").datagrid("resize", { width: "100%" });
                //$("#ProductNameMerge").datagrid("resize", { width: "100%" });
                //$("#Order_Head_panel").panel("resize", { width: "100%" });
                //setTimeout(function () {
                //    var paddigLeftRight = { "padding-left": "0px", "margin-left": "0px", "padding-right": "0px", "margin-right": "0px" };
                //    $("#edit_div_one").css(paddigLeftRight);
                //    $("#edit_div_two").css(paddigLeftRight);
                //    $("#OrderInfo").css(paddigLeftRight);
                //    $("#OrderDetail").css(paddigLeftRight);
                //    $("#ProductNameMerge").css(paddigLeftRight);
                //    $("#Order_Head_panel").css(paddigLeftRight);
                //    SetbuttonssWidth();
                //}, 100);
            };
        }

        function ToCusIndex(id) {
            var rowdata = $dg.datagrid('getSelections');         
            if (rowdata.length == 0) {
                $.messager.alert("提示", "请选择一条信息!");
            }
            else if (rowdata.length > 1) {
                $.messager.alert("提示", "只能请选择一条信息!");
            } else {
                var rowdata = $dg.datagrid('getSelected');
                id = rowdata.Id;
                $(location).attr('href', "/CustomsInspections/CusIndex?OPS_ENid=" + id);
            }     
        }
        //$(location).attr('href', "/CustomsInspections/CusInsIndex?oId=" + getQueryString("id"));

        function ToDocMent(id)
        {
            var rowdata = $dg.datagrid('getSelections');
            if (rowdata.length == 0) {
                $.messager.alert("提示", "请选择一条信息!");
            }
            else if (rowdata.length > 1) {
                $.messager.alert("提示", "只能请选择一条信息!");
            } else {
                var rowdata = $dg.datagrid('getSelected');
                var id = rowdata.Id;
                var Operation_ID = rowdata.Operation_Id;
                $.ajax({
                    type: 'post',
                    url: '/OPS_EntrustmentInfors/ContentResultDemo',
                    data:{id:rowdata.Id},
                    success: function (data) {
                        if (data.Success) {
                            //console.log("success");                                                                            
                                $(location).attr('href', "/DocumentManagements/Index?id=" + data.Id);
                        } else {
                            $.messager.alert("提示", data.ErrMsg);
                        }
                    }
                });
            }
        }
    </script>
}

